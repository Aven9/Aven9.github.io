<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">

<link href="https://cdn.bootcss.com/KaTeX/0.7.1/katex.min.css" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Aven&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Aven&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Wenjie Zhang">
<meta property="article:tag" content="Developer">
<meta property="article:tag" content=" Computer Science">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>Aven's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Aven's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/11/DP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Wenjie Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aven's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/11/DP/" class="post-title-link" itemprop="url">DP</a>
        </h1>

        <div class="post-meta">

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1><span id="前言"> 前言</span></h1>
<p>DP说起来简单，但是在实际问题里确实不容易想到迭代下去的规律，毕竟不是每个题都想斐波那契那样，迭代规律人尽皆知orz，这个合集会大概对几个问题进行DP思路整理。</p>
<h1><span id="dp思想"> DP思想</span></h1>
<p>简单来说，应用问题常见的DP是在递归的基础之上提出的，通过存储需要重复计算的中间结果来优化结果的生成的一种online方案。以斐波那契为例，这个问题的递归版本为：</p>
<pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fib</span><span class="hljs-params">(n)</span>:</span>
  <span class="hljs-keyword">if</span> n == <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> n == <span class="hljs-number">2</span>:
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
  <span class="hljs-keyword">return</span> fib(n<span class="hljs-number">-1</span>) + fib(n<span class="hljs-number">-2</span>)
</code></pre>
<p>但递归生成了很多重复计算。比如，fib(5) = fib(4)+fib(3), 而fib(4) = fib(3)+fib(2), 到此fib(3)就和另一次递归操作里的fib(3)重合了，长此以往一定浪费了很多时间。因此更好的做法是将可能的递归操作的结果保存起来，这样就能达到时间复杂度O(2^n)到O(n)的优化٩(๑&gt;◡&lt;๑)۶</p>
<pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fib_memoized</span><span class="hljs-params">(n, memo)</span>:</span>
  <span class="hljs-keyword">if</span> memo[n] <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> null:
    <span class="hljs-keyword">return</span> memo[n]
  <span class="hljs-keyword">if</span> n == <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> n == <span class="hljs-number">2</span>:
    result = <span class="hljs-number">1</span>
  <span class="hljs-keyword">else</span>:
    result = fib(n<span class="hljs-number">-1</span>) + fib(n<span class="hljs-number">-2</span>)
  memo[n] = result
  <span class="hljs-keyword">return</span> result
</code></pre>
<p>不过这个方案还有可以改进的地方：采用递归的方式在处理较大输入的时候可能会导致栈溢出，可以用Bottom-up方式生成存储较低层次的fib结果以供使用，从而避免递归：</p>
<pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fib_bottom_up</span><span class="hljs-params">(n)</span>:</span>
  <span class="hljs-keyword">if</span> n == <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> n == <span class="hljs-number">2</span>:
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
  bottom_up = new int[n+<span class="hljs-number">1</span>]
  bottom_up[<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>
  bottom_up[<span class="hljs-number">2</span>] = <span class="hljs-number">1</span>
  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>, n+<span class="hljs-number">1</span>):
    bottom_up[i] = bottom_up[i<span class="hljs-number">-1</span>]+bottom_up[i<span class="hljs-number">-2</span>]
  <span class="hljs-keyword">return</span> bottom_up[n]
    
</code></pre>
<p>那么，接下来就是具体问题合集了[]<sub>(￣▽￣)</sub>*</p>
<h1><span id="maximum-subarray"> Maximum Subarray</span></h1>
<p>题源：<a href="https://leetcode.com/problems/maximum-subarray/" target="_blank" rel="noopener">leetcode</a></p>
<p>描述：Given an integer array <code>nums</code>, find the contiguous subarray (containing at least one number) which has the largest sum and return its sum.</p>
<p><strong>Example:</strong></p>
<pre class="highlight"><code class>Input: [-2,1,-3,4,-1,2,1,-5,4],
Output: 6
Explanation: [4,-1,2,1] has the largest sum = 6.
</code></pre>
<p>Breakthrough Point：</p>
<ul>
<li>初始子规模：
<ul>
<li>分析：若array规模缩小到只含有一个元素：[-2]，显然这时候maximum subarray结果就是它自身</li>
<li>结果：只含有一个元素的array，记录它的唯一元素</li>
</ul>
</li>
<li>更大的规模：
<ul>
<li>分析：若我们已经知道array: [-2]的maximum subarray = -1，那么对于[-2, 1]中的新增元素1，我们有两个选择：
<ol>
<li>以新增元素作为新的subarray起点，返回1</li>
<li>以上一个subarray的返回结果加上新增元素作为返回值，返回(-2+1)</li>
</ol>
</li>
<li>结果：array from index 0 to n: 记录<code>max(function(array, n-1), array[n])</code></li>
<li>注意：由于subarray的元素是连续的，所以在这个递归过程中每个元素对应的记录为：<strong>从0到i的array中，包含了array[i]的最大subarray结果</strong></li>
</ul>
</li>
<li>总体：遍历整个array，用数组记录每个元素对应的maximum subarray值，并拿到其中最大的那个</li>
</ul>
<p>代码实现：</p>
<pre class="highlight"><code class="c++"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> {</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">maxSubArray</span><span class="hljs-params">(<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt;&amp; nums)</span> </span>{
        <span class="hljs-keyword">int</span> len = nums.<span class="hljs-built_in">size</span>();
        <span class="hljs-keyword">if</span> (len == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        }
        <span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">memo</span><span class="hljs-params">(len, <span class="hljs-number">0</span>)</span></span>;
        memo[<span class="hljs-number">0</span>] = nums[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">int</span> maxRes = memo[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; len; ++i) {
            memo[i] = <span class="hljs-built_in">max</span>(nums[i], nums[i]+memo[i<span class="hljs-number">-1</span>]);
            <span class="hljs-keyword">if</span> (memo[i] &gt; maxRes) {
                maxRes = memo[i];
            }
        }
        <span class="hljs-keyword">return</span> maxRes;
    }
};
</code></pre>
<h1><span id="longest-palindromic-substring"> Longest Palindromic Substring</span></h1>
<p>来源：<a href="https://leetcode.com/problems/longest-palindromic-substring/" target="_blank" rel="noopener">LeetCode</a></p>
<p>描述：Given a string <strong>s</strong>, find the longest palindromic substring in <strong>s</strong>. You may assume that the maximum length of <strong>s</strong> is 1000.</p>
<p><strong>Example 1:</strong></p>
<pre class="highlight"><code class>Input: &quot;babad&quot;
Output: &quot;bab&quot;
Note: &quot;aba&quot; is also a valid answer.
</code></pre>
<p><strong>Example 2:</strong></p>
<pre class="highlight"><code class>Input: &quot;cbbd&quot;
Output: &quot;bb&quot;
</code></pre>
<p>Breakthrough Point：</p>
<ul>
<li>初始子规模：若<code>s == &quot;&quot; or s.length() == 1</code>, 最大palindrome为它自己</li>
<li>更大规模：对于<code>s.length() &gt; 2</code>的情况，考虑将每个元素作为palindrome的中心或中心线旁的第一个元素，记录最长的palindrome，可能有两种情况：
<ol>
<li>对称中心是字母，如：“aba”，对称中心为b，此时以b为中心，令<code>left = index-1, right = index+1</code>同时向左向右寻找对称元素，直到找到最大的palindrome</li>
<li>对称中心不是字母，如&quot;abba&quot;，此时有<code>array[index] == array[index+1]</code>成立，令<code>left = index, right = index+1</code>向左向右寻找对称元素，直到找到最大的palindrome</li>
</ol>
</li>
<li>遍历array，得到其中最大的palindrome</li>
</ul>
<pre class="highlight"><code class="c++"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> {</span>
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-built_in">string</span> <span class="hljs-title">longestPalindrome</span><span class="hljs-params">(<span class="hljs-built_in">string</span> s)</span> </span>{
        <span class="hljs-keyword">if</span> (s.empty()||s.length()==<span class="hljs-number">1</span>) {
            <span class="hljs-keyword">return</span> s;
        }
        <span class="hljs-keyword">int</span> start = <span class="hljs-number">0</span>, <span class="hljs-built_in">end</span> = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; s.length(); ++i) {
            <span class="hljs-keyword">int</span> len1 = expandPalindrome(s, i<span class="hljs-number">-1</span>, i+<span class="hljs-number">1</span>);
            <span class="hljs-keyword">if</span> (len1 &gt; <span class="hljs-built_in">end</span>-start+<span class="hljs-number">1</span>) {
                start = i-len1/<span class="hljs-number">2</span>;
                <span class="hljs-built_in">end</span> = i+len1/<span class="hljs-number">2</span>;
            }
            <span class="hljs-keyword">int</span> len2 = expandPalindrome(s, i, i+<span class="hljs-number">1</span>);
            <span class="hljs-keyword">if</span> (len2 &gt; <span class="hljs-built_in">end</span>-start+<span class="hljs-number">1</span>) {
                start = i-len2/<span class="hljs-number">2</span>+<span class="hljs-number">1</span>;
                <span class="hljs-built_in">end</span> = i+len2/<span class="hljs-number">2</span>;
            }

        }
        <span class="hljs-keyword">return</span> s.substr(start, <span class="hljs-built_in">end</span>-start+<span class="hljs-number">1</span>);
    }
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">expandPalindrome</span><span class="hljs-params">(<span class="hljs-built_in">string</span> &amp; s, <span class="hljs-keyword">int</span> start, <span class="hljs-keyword">int</span> <span class="hljs-built_in">end</span>)</span> </span>{
        <span class="hljs-keyword">if</span> (start &gt; <span class="hljs-built_in">end</span> || start &lt; <span class="hljs-number">0</span> || <span class="hljs-built_in">end</span> &gt;= s.length()) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        }
        <span class="hljs-keyword">int</span> len = <span class="hljs-built_in">end</span>-start &gt; <span class="hljs-number">1</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span>(start &gt;= <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-built_in">end</span> &lt; s.length() &amp;&amp; s[start] == s[<span class="hljs-built_in">end</span>]) {
            len+=<span class="hljs-number">2</span>;
            start--;
            <span class="hljs-built_in">end</span>++;
        }
        <span class="hljs-keyword">return</span> len;
    }
};
</code></pre>
<h1><span id="wildcard-matching"> WildCard Matching</span></h1>
<p>题源：<a href="https://leetcode.com/problems/wildcard-matching/" target="_blank" rel="noopener">LeetCode</a></p>
<p>描述：Given an input string (<code>s</code>) and a pattern (<code>p</code>), implement wildcard pattern matching with support for <code>'?'</code> and <code>'*'</code>.</p>
<pre class="highlight"><code class>'?' Matches any single character.
'*' Matches any sequence of characters (including the empty sequence).
</code></pre>
<p>The matching should cover the <strong>entire</strong> input string (not partial).</p>
<p><strong>Note:</strong></p>
<ul>
<li><code>s</code> could be empty and contains only lowercase letters <code>a-z</code>.</li>
<li><code>p</code> could be empty and contains only lowercase letters <code>a-z</code>, and characters like <code>?</code> or <code>*</code>.</li>
</ul>
<p><strong>Example 1:</strong></p>
<pre class="highlight"><code class>Input:
s = &quot;aa&quot;
p = &quot;a&quot;
Output: false
Explanation: &quot;a&quot; does not match the entire string &quot;aa&quot;.
</code></pre>
<p><strong>Example 2:</strong></p>
<pre class="highlight"><code class>Input:
s = &quot;aa&quot;
p = &quot;*&quot;
Output: true
Explanation: '*' matches any sequence.
</code></pre>
<p><strong>Example 3:</strong></p>
<pre class="highlight"><code class>Input:
s = &quot;cb&quot;
p = &quot;?a&quot;
Output: false
Explanation: '?' matches 'c', but the second letter is 'a', which does not match 'b'.
</code></pre>
<p><strong>Example 4:</strong></p>
<pre class="highlight"><code class>Input:
s = &quot;adceb&quot;
p = &quot;*a*b&quot;
Output: true
Explanation: The first '*' matches the empty sequence, while the second '*' matches the substring &quot;dce&quot;.
</code></pre>
<p><strong>Example 5:</strong></p>
<pre class="highlight"><code class>Input:
s = &quot;acdcb&quot;
p = &quot;a*c?b&quot;
Output: false
</code></pre>
<p>Breakthrough point：</p>
<p>由于s和p可能存在多对多的匹配关系，子串的匹配显然对串的匹配有直接联系，因此考虑用二维数组<code>M[p.length()+1][s.length()+1]</code>存储s和p的匹配映射</p>
<ul>
<li>初始子规模
<ul>
<li>分析：匹配的情况<code>s == &quot;&quot; &amp;&amp; p ==&quot;&quot; or s == &quot;&quot; &amp;&amp; p仅由*组成 or s为任意字符 &amp;&amp; p仅由*组成 or s为任意字符 &amp;&amp; p = &quot;.&quot; or s == p</code></li>
<li>结果：<code>M[0][0] = true, M[0][j] = false, M[1][0] = p[1]==&quot;*&quot;,M[i][0] = M[i-1]&amp;&amp;p[i]==&quot;*&quot;</code></li>
</ul>
</li>
<li>更大的规模：若已知<code>M[i-1][j-1], M[i-1][j], M[i][j-1]</code>的情况：
<ol>
<li>没有星星的时候，对应位置的字母如果能够匹配上，串和模式的匹配情况就只和p[i-1]和s[j-1]的匹配情况有关：<code>if p[i] != '*' and (p[i] == s[j]||p[i] == '.') then M[i][j] = M[i-1][j-1]</code></li>
<li>有星星的时候，要考虑这颗星星是充当空气还是确实能代表些什么
<ul>
<li>星星是空气：e.g. <code>s = &quot;abc&quot;, p = &quot;abc*&quot;</code>, 如果我们此时知道串abc和模式abc匹配，那么显然<code>abc</code>和<code>abc*</code>也应该匹配，这时候<code>*</code>没有任何作用：<code>if p[i] == '*'and M[i-1][j] == true then M[i][j] = true</code></li>
<li>星星不是空气：e.g.  <code>s = &quot;abc&quot;, p = &quot;a*&quot;</code>, 如果我们此时知道串a和模式a匹配，那么显然<code>a</code>和<code>a*</code>也匹配(由上条可得到)，由这个条件可以推断<code>ab</code>和<code>a*</code>匹配(先前星星充当了空气，此时我们让它和非空字符匹配也是可以的)：<code>if p[i] == '*'and M[i][j-1] == true then M[i][j] = true</code></li>
</ul>
</li>
<li>如果都不是，那就不匹配</li>
</ol>
</li>
</ul>
<pre class="highlight"><code class="c++"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> {</span>
<span class="hljs-keyword">public</span>:
   <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">isMatch</span><span class="hljs-params">(<span class="hljs-built_in">string</span> s, <span class="hljs-built_in">string</span> p)</span> </span>{
        <span class="hljs-keyword">int</span> m = p.length(), n = s.length();
        <span class="hljs-function"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">bool</span>&gt;&gt; <span class="hljs-title">M</span><span class="hljs-params">(m+<span class="hljs-number">1</span>, <span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">bool</span>&gt;(n+<span class="hljs-number">1</span>, <span class="hljs-literal">false</span>))</span></span>;
        M[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; m+<span class="hljs-number">1</span>; ++i) {
            M[i][<span class="hljs-number">0</span>] = M[i<span class="hljs-number">-1</span>][<span class="hljs-number">0</span>] &amp;&amp; p[i<span class="hljs-number">-1</span>] == <span class="hljs-string">'*'</span>;
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; m+<span class="hljs-number">1</span>; ++i) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt; n+<span class="hljs-number">1</span>; ++j) {
                <span class="hljs-keyword">if</span> (p[i<span class="hljs-number">-1</span>] != <span class="hljs-string">'*'</span> &amp;&amp; (p[i<span class="hljs-number">-1</span>]== s[j<span class="hljs-number">-1</span>]||p[i<span class="hljs-number">-1</span>]==<span class="hljs-string">'?'</span>)) {
                    M[i][j] = M[i<span class="hljs-number">-1</span>][j<span class="hljs-number">-1</span>];
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (p[i<span class="hljs-number">-1</span>] == <span class="hljs-string">'*'</span> &amp;&amp; (M[i<span class="hljs-number">-1</span>][j]||M[i][j<span class="hljs-number">-1</span>])) {
                    M[i][j] = <span class="hljs-literal">true</span>;
                }
            }
        }
        <span class="hljs-keyword">return</span> M[m][n];
    }
};
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/27/Solution-Set-for-Flutter-Issues/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Wenjie Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aven's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/27/Solution-Set-for-Flutter-Issues/" class="post-title-link" itemprop="url">Solution Set for Flutter Issues</a>
        </h1>

        <div class="post-meta">

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>此处是一些食用flutter过程中遇到的问题合集</p>
<!--TOC-->
<h1><span id="multiple-commands-produce-buildiosdebug-iphonesimulatorrunnerappframeworksflutterframework"> Multiple commands produce '/build/ios/Debug-iphonesimulator/Runner.app/Frameworks/Flutter.framework</span></h1>
<p>此问题影响所有使用Xcode 10构建的，依赖CocoaPods的Flutter项目-通常这意味着那些依赖插件的项目。</p>
<h2><span id="问题根源"> 问题根源</span></h2>
<p>使用插件时，有两个相互竞争的构建操作，它们将Flutter.framework复制到构建应用程序的Frameworks目录中：</p>
<ol>
<li>Runner项目的Embed Frameworks构建阶段</li>
<li>Pod安装在项目中创建的[CP] Embed Pods Frameworks构建阶段。</li>
</ol>
<p>第1项可以确保在没有插件（因此Xcode项目中没有CocoaPods集成）的情况下将框架复制到内置应用程序中。第2项之所以存在，是因为Flutter的podspec将Flutter.framework声明为vended_framework，并且CocoaPods在传递性关闭CocoaPods依赖项时自动为每个此类vended_framework添加了一个复制步骤。</p>
<h2><span id="解决办法"> 解决办法：</span></h2>
<ol>
<li>使用旧版构建系统。打开ios / Runner.xcworkspace，然后将构建系统更改为Legacy Build System。</li>
<li>使用新的Xcode 10构建系统。打开ios / Runner.xcworkspace
<ul>
<li>在项目导航器侧栏中选择Runner项目。</li>
<li>在主视图中，选择Runner Target，然后选择Build Phases选项卡。</li>
<li>展开Embed Frameworks，然后从框架列表中选择Flutter.framework。</li>
<li>单击<code>-</code>从列表中删除Flutter.framework（确保保留App.framework）。</li>
</ul>
</li>
</ol>
<p>最简单的选择是从上面的“嵌入框架”步骤中消除Flutter.framework，即使在没有插件依赖性的情况下，也始终依赖于pod安装。我们需要更新Flutter工具以自动编辑现有项目，以从Embed Frameworks步骤中删除Flutter.framework。</p>
<p>优点：更简单的代码。缺点：使cocoapods成为Flutter开发所需的安装步骤，第一次运行涉及大量且非常缓慢的repo下载。</p>
<p>更好一点的选择是让我们自动检测项目是否使用插件，并编辑Xcode项目以检查是否在使用插件的情况下自动从Embed Frameworks步骤中删除Flutter.framework，如果不使用插件则将其添加。</p>
<p>优点：更好的用户体验。缺点：更复杂的代码。</p>
<p>无论哪种方式，我们都需要某种机制来自动编辑project.pbxproj文件，并从embed frameworks build步骤中删除该框架。支持将其重新添加并不需要太多的工作，而是可以带来更好的体验。</p>
<blockquote>
<p>来源：<a href="https://github.com/flutter/flutter/issues/20685" target="_blank" rel="noopener">https://github.com/flutter/flutter/issues/20685</a></p>
</blockquote>
<h1><span id="flutter-doctor-error-could-not-authenticate-download-server-you-may-be-experiencing-a-man-in-the-middle-attack"> flutter doctor error Could not authenticate download server. You may be experiencing a man-in-the-middle attack.</span></h1>
<p>更新flutter版本之后兜兜转转就来到了这里，<s>直接愣住</s>。不过检查一下代理和环境变量就可以解决这个问题了。环境变量设置如下：</p>
<pre class="highlight"><code class>export PUB_HOSTED_URL=https://pub.flutter-io.cn //国内用户需要设置
export FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn //国内用户需要设置
export PATH=PATH_TO_FLUTTER_GIT_DIRECTORY/flutter/bin:$PATH
</code></pre>
<blockquote>
<p>packages get操作特别缓慢，或者是launch simulator特别缓慢的时候也考虑一下是不是没有配置环境变量或者是代理问题</p>
</blockquote>
<h1><span id="flutter-failing-to-connect-to-emulator-with-vscode"> Flutter failing to connect to emulator with VSCode</span></h1>
<p>Android模拟器连接不到可以这么操作：</p>
<ol>
<li>Open Android Studio</li>
<li>Tools -&gt; AVD Manager</li>
<li>Virtual Device -&gt; Actions (Refer Image)</li>
<li>Click On Stop</li>
<li>Now Start Emulator</li>
</ol>
<p>iOS模拟器连接不到时，运行一下<code>flutter doctor -v</code>, 有可能是Xcode build版本问题。可以手动更新Xcode，重新运行<code>flutter doctor -v</code>, 之后按照提示确认一下条款即可。</p>
<h1><span id="dart-package-version-conflicts"> Dart package version conflicts</span></h1>
<ol>
<li>将冲突的package version全部用<code>any</code>替代</li>
<li>执行<code>flutter packages get</code></li>
<li>生成的<code>pubspec.lock</code>文件里面会有不冲突的版本号，按照这个填回来替换<code>any</code></li>
<li>执行<code>flutter packages get</code></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/26/AIBeautify-Intro/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Wenjie Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aven's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/26/AIBeautify-Intro/" class="post-title-link" itemprop="url">AIBeautify-Intro</a>
        </h1>

        <div class="post-meta">

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1><span id="aibeautify画板实现"> AIBeautify–画板实现</span></h1>
<p>前面一篇文章提到，GAN作为一种处理Image Completion和Image Translation的高效神经网络，在人像编辑上提供了很棒的思路。用户能够根据一张人像照片，思考想要修改的地方，用蒙板遮盖这个地方，然后在蒙板上简单绘制修改后的局部草图，将图片和修改数据上传至服务器，即可生成智能的修改后图片。例如：</p>
<p>原图：<br>
<img src="./AIBeautify-Intro/before1.png" alt></p>
<img src="/2020/02/26/AIBeautify-Intro/before1.png" class>
<p>涂改：<br>
<img src="./AIBeautify-Intro/editing1.png" alt></p>
<img src="/2020/02/26/AIBeautify-Intro/editing1.png" class>
<p>返回:<br>
<img src="./AIBeautify-Intro/after1.png" alt></p>
<img src="/2020/02/26/AIBeautify-Intro/after1.png" class>
<p>具体的模型搭建参考了https://github.com/run-youngjoo/SC-FEGAN</p>
<p>本文会简单谈谈利用它来完成一个AI人像编辑软件的过程。</p>
<h2><span id="需求分析"> 需求分析</span></h2>
<h3><span id="数据描述"> 数据描述</span></h3>
<ul>
<li>静态数据：静态数据主要包括处理的文件和记录数</li>
<li>动态数据：动态数据包括输入数据和过程数据和输出数据。输入数据主要是原始图片和用户涂改，包括蒙板区域和涂鸦数据；输出数据包括处理后的图片。</li>
</ul>
<h3><span id="功能需求"> 功能需求</span></h3>
<p>功能需求的核心模块为图片的导入，接收从相册获取的图片，作为画板的图片输入；绘制涂鸦则在导入图片的基础上进行以用户灵感为驱动的再创造，在导入图片的基础上新增涂鸦区域；修改图片功能接收用户的涂改素材为输入，返回处理后的图片作为结果；存储结果则将获取到的图片进行本地存储。</p>
<h2><span id="主要接口"> 主要接口</span></h2>
<h3><span id="上传图片"> 上传图片</span></h3>
<p><em><strong>url:</strong></em> /image/upload</p>
<p><em><strong>method:</strong></em> POST</p>
<p><em><strong>params:</strong></em></p>
<pre class="highlight"><code class>file: file
</code></pre>
<p><em><strong>return:</strong></em></p>
<pre class="highlight"><code class>{
    id: int,
}
</code></pre>
<h3><span id="上传修改数据"> 上传修改数据</span></h3>
<p><em><strong>url:</strong></em> /image/info/upload</p>
<p><em><strong>method:</strong></em> POST</p>
<p><em><strong>params:</strong></em></p>
<pre class="highlight"><code class>id: int,
mask: [{
    prev: [int, int],
    curr: [int, int],
}], //消除笔触记录
sketch: [{
    prev: [int, int],
    curr: [int, int],
}], //草图笔触记录
stroke: [{
    prev: [int, int],
    curr: [int, int],
    color: string,
}]， //涂色笔触位置记录
</code></pre>
<p><em><strong>return:</strong></em></p>
<pre class="highlight"><code class>{
    url: string, //处理完图片的url
}
</code></pre>
<h3><span id="获得该用户相关图片数据"> 获得该用户相关图片数据</span></h3>
<p><em><strong>url:</strong></em> /image/info/get</p>
<p><em><strong>method:</strong></em> POST</p>
<p><em><strong>params:</strong></em></p>
<pre class="highlight"><code class>page: int, //从1开始
limit: int, //每页有多少个
</code></pre>
<p><em><strong>return:</strong></em></p>
<pre class="highlight"><code class>{
    totalNumber: int, //总共有多少个
    list: [{
        id: int, //编号
        oroginUrl: string, //原图地址
        nowUrl: string, //处理后的地址
        status: int, //图片状态，0为未处理，1为已处理，要注意未处理的nowUrl为空
    }]
}
</code></pre>
<h2><span id="画板模块实现"> 画板模块实现</span></h2>
<p>画板模块实现部分参考了 <a href="https://github.com/Harley-xk/MaLiang%E3%80%82" target="_blank" rel="noopener">https://github.com/Harley-xk/MaLiang。</a></p>
<ul>
<li>
<p>借助贝塞尔曲线原理将一系列的点生成为较为圆滑的曲线。</p>
<pre class="highlight"><code class="swift"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BezierGenerator</span> </span>{
  
  	<span class="hljs-keyword">var</span> points: [<span class="hljs-type">CGPoint</span>] = []
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> step = <span class="hljs-number">0</span>
  
    <span class="hljs-keyword">init</span>(beginPoint: <span class="hljs-type">CGPoint</span>) {
        begin(with: beginPoint)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">begin</span><span class="hljs-params">(with point: CGPoint)</span></span> {
        points.append(point)
    }
    
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">pushPoint</span><span class="hljs-params">(<span class="hljs-number">_</span> point: CGPoint)</span></span> -&gt; [<span class="hljs-type">CGPoint</span>] {
        <span class="hljs-keyword">if</span> point == points.last {
            <span class="hljs-keyword">return</span> []
        }
        points.append(point)
        step += <span class="hljs-number">1</span>
        <span class="hljs-keyword">let</span> result = genericPathPoints()
        <span class="hljs-keyword">return</span> result
    }
    
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">finish</span><span class="hljs-params">()</span></span> {
        step = <span class="hljs-number">0</span>
        points.removeAll()
    }
  
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">genericPathPoints</span><span class="hljs-params">()</span></span> -&gt; [<span class="hljs-type">CGPoint</span>] {
        
        <span class="hljs-keyword">var</span> begin: <span class="hljs-type">CGPoint</span>
        <span class="hljs-keyword">var</span> control: <span class="hljs-type">CGPoint</span>
        <span class="hljs-keyword">let</span> end = <span class="hljs-type">CGPoint</span>.middle(p1: points[step], p2: points[step + <span class="hljs-number">1</span>])

        <span class="hljs-keyword">var</span> vertices: [<span class="hljs-type">CGPoint</span>] = []
        <span class="hljs-keyword">if</span> step == <span class="hljs-number">1</span> {
            begin = points[<span class="hljs-number">0</span>]
            <span class="hljs-keyword">let</span> middle1 = <span class="hljs-type">CGPoint</span>.middle(p1: points[<span class="hljs-number">0</span>], p2: points[<span class="hljs-number">1</span>])
            control = <span class="hljs-type">CGPoint</span>.middle(p1: middle1, p2: points[<span class="hljs-number">1</span>])
        } <span class="hljs-keyword">else</span> {
            begin = <span class="hljs-type">CGPoint</span>.middle(p1: points[step - <span class="hljs-number">1</span>], p2: points[step])
            control = points[step]
        }
        
        <span class="hljs-comment">/// segements are based on distance about start and end point</span>
        <span class="hljs-keyword">let</span> dis = begin.<span class="hljs-built_in">distance</span>(to: end)
        <span class="hljs-keyword">let</span> segements = <span class="hljs-built_in">max</span>(<span class="hljs-type">Int</span>(dis / <span class="hljs-number">5</span>), <span class="hljs-number">2</span>)

        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> ..&lt; segements {
            <span class="hljs-keyword">let</span> t = <span class="hljs-type">CGFloat</span>(i) / <span class="hljs-type">CGFloat</span>(segements)
            <span class="hljs-keyword">let</span> x = pow(<span class="hljs-number">1</span> - t, <span class="hljs-number">2</span>) * begin.x + <span class="hljs-number">2.0</span> * (<span class="hljs-number">1</span> - t) * t * control.x + t * t * end.x
            <span class="hljs-keyword">let</span> y = pow(<span class="hljs-number">1</span> - t, <span class="hljs-number">2</span>) * begin.y + <span class="hljs-number">2.0</span> * (<span class="hljs-number">1</span> - t) * t * control.y + t * t * end.y
            vertices.append(<span class="hljs-type">CGPoint</span>(x: x, y: y))
        }
        vertices.append(end)
        <span class="hljs-keyword">return</span> vertices
    }
}
</code></pre>
</li>
<li>
<p>Canvas记录绘制的点以及它们的序号（时间相关）和位置，清除的点以及序号位置，记录redo的点和undo的点用于扩展redo和undo画板功能。</p>
<pre class="highlight"><code class="swift"><span class="hljs-comment">/// base element that can be draw on canvas</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">CanvasElement</span>: <span class="hljs-title">Codable</span> </span>{
    
    <span class="hljs-comment">/// index in the emelent list of canvas</span>
    <span class="hljs-comment">/// element with smaller index will draw earlier</span>
    <span class="hljs-comment">/// Automatically set by Canvas.Data</span>
    <span class="hljs-keyword">var</span> index: <span class="hljs-type">Int</span> { <span class="hljs-keyword">get</span> <span class="hljs-keyword">set</span> }
    
    <span class="hljs-comment">/// draw this element on specifyied target</span>
    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">drawSelf</span><span class="hljs-params">(on target: RenderTarget)</span></span>
}

<span class="hljs-comment">/// clear action, a command to clear the canvas</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ClearAction</span>: <span class="hljs-title">CanvasElement</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> index: <span class="hljs-type">Int</span> = <span class="hljs-number">0</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">drawSelf</span><span class="hljs-params">(on target: RenderTarget)</span></span> {
        target.clear()
    }
}

<span class="hljs-comment">/// content data on canvas</span>
<span class="hljs-keyword">open</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CanvasData</span> </span>{
    
    <span class="hljs-comment">/// elements array before an clear action</span>
    <span class="hljs-keyword">open</span> <span class="hljs-keyword">internal</span>(<span class="hljs-keyword">set</span>) <span class="hljs-keyword">var</span> clearedElements: [[<span class="hljs-type">CanvasElement</span>]] = []
    
    <span class="hljs-comment">/// current drawing elements</span>
    <span class="hljs-keyword">open</span> <span class="hljs-keyword">internal</span>(<span class="hljs-keyword">set</span>) <span class="hljs-keyword">var</span> elements: [<span class="hljs-type">CanvasElement</span>] = []
    
    <span class="hljs-comment">/// current unfinished element</span>
    <span class="hljs-keyword">open</span> <span class="hljs-keyword">internal</span>(<span class="hljs-keyword">set</span>) <span class="hljs-keyword">var</span> currentElement: <span class="hljs-type">CanvasElement?</span>
    
    <span class="hljs-comment">/// Append a set of lines to current element in document</span>
    <span class="hljs-comment">///</span>
    <span class="hljs-comment">/// - Parameters:</span>
    <span class="hljs-comment">///   - lines: lines to add</span>
    <span class="hljs-comment">///   - brush: brush used to draw these lines</span>
    <span class="hljs-comment">///   - isNewElement: if sets true, current line strip will be set to finished and a new one will be setup</span>
    <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">append</span><span class="hljs-params">(lines: [MLLine], with brush: Brush)</span></span> {
        <span class="hljs-keyword">guard</span> lines.<span class="hljs-built_in">count</span> &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span>
        }
        <span class="hljs-comment">// append lines to current line strip</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> lineStrip = currentElement <span class="hljs-keyword">as</span>? <span class="hljs-type">LineStrip</span>, lineStrip.brush === brush {
            lineStrip.append(lines: lines)
        } <span class="hljs-keyword">else</span> {
            finishCurrentElement()
            
            <span class="hljs-keyword">let</span> lineStrip = <span class="hljs-type">LineStrip</span>(lines: lines, brush: brush)
            currentElement = lineStrip
            undoArray.removeAll()
            h_onElementBegin?(<span class="hljs-keyword">self</span>)
        }
    }
    
    <span class="hljs-comment">/// add a chartlet to elements</span>
    <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">append</span><span class="hljs-params">(chartlet: Chartlet)</span></span> {
        finishCurrentElement()
        chartlet.index = lastElementIndex + <span class="hljs-number">1</span>
        elements.append(chartlet)
        undoArray.removeAll()
        h_onElementFinish?(<span class="hljs-keyword">self</span>)
    }
    
    <span class="hljs-comment">/// index for latest element</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> lastElementIndex: <span class="hljs-type">Int</span> {
        <span class="hljs-keyword">return</span> elements.last?.index ?? <span class="hljs-number">0</span>
    }
    
    <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">finishCurrentElement</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">var</span> element = currentElement <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span>
        }
        element.index = lastElementIndex + <span class="hljs-number">1</span>
        elements.append(element)
        currentElement = <span class="hljs-literal">nil</span>
        h_onElementFinish?(<span class="hljs-keyword">self</span>)
    }
    
    <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">appendClearAction</span><span class="hljs-params">()</span></span> {
        finishCurrentElement()

        <span class="hljs-keyword">guard</span> elements.<span class="hljs-built_in">count</span> &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span>
        }
        clearedElements.append(elements)
        elements.removeAll()
    }
    
    <span class="hljs-comment">// MARK: - Undo &amp; Redo</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> canRedo: <span class="hljs-type">Bool</span> {
        <span class="hljs-keyword">return</span> undoArray.<span class="hljs-built_in">count</span> &gt; <span class="hljs-number">0</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> canUndo: <span class="hljs-type">Bool</span> {
        <span class="hljs-keyword">return</span> elements.<span class="hljs-built_in">count</span> &gt; <span class="hljs-number">0</span> || clearedElements.<span class="hljs-built_in">count</span> &gt; <span class="hljs-number">0</span>
    }
    
    <span class="hljs-keyword">private</span>(<span class="hljs-keyword">set</span>) <span class="hljs-keyword">var</span> undoArray: [<span class="hljs-type">CanvasElement</span>] = []
    
    <span class="hljs-keyword">internal</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">undo</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">Bool</span> {
        finishCurrentElement()
        
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> last = elements.last {
            undoArray.append(last)
            elements.removeLast()
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> lastCleared = clearedElements.last {
            undoArray.append(<span class="hljs-type">ClearAction</span>())
            elements = lastCleared
            clearedElements.removeLast()
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
        }
        h_onUndo?(<span class="hljs-keyword">self</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    }
    
    <span class="hljs-keyword">internal</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">redo</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">Bool</span> {
        <span class="hljs-keyword">guard</span> currentElement == <span class="hljs-literal">nil</span>, <span class="hljs-keyword">let</span> last = undoArray.last <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
        }
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-number">_</span> = last <span class="hljs-keyword">as</span>? <span class="hljs-type">ClearAction</span> {
            clearedElements.append(elements)
            elements.removeAll()
        } <span class="hljs-keyword">else</span> {
            elements.append(last)
        }
        undoArray.removeLast()
        h_onRedo?(<span class="hljs-keyword">self</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    }
    
    <span class="hljs-comment">// MARK: - EventHandler</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">typealias</span> <span class="hljs-type">EventHandler</span> = (<span class="hljs-type">CanvasData</span>) -&gt; ()
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> h_onElementBegin: <span class="hljs-type">EventHandler?</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> h_onElementFinish: <span class="hljs-type">EventHandler?</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> h_onRedo: <span class="hljs-type">EventHandler?</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> h_onUndo: <span class="hljs-type">EventHandler?</span>
    
    <span class="hljs-comment">/// this closure will be called when a continuously elements begins</span>
    <span class="hljs-meta">@discardableResult</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">onElementBegin</span><span class="hljs-params">(<span class="hljs-number">_</span> h: @escaping EventHandler)</span></span> -&gt; <span class="hljs-type">Self</span> {
        h_onElementBegin = h
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>
    }
    
    <span class="hljs-comment">/// this closure will be called when an element finished</span>
    <span class="hljs-meta">@discardableResult</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">onElementFinish</span><span class="hljs-params">(<span class="hljs-number">_</span> h: @escaping EventHandler)</span></span> -&gt; <span class="hljs-type">Self</span> {
        h_onElementFinish = h
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>
    }
    
    <span class="hljs-comment">/// this closure will be called when a redo command is performed</span>
    <span class="hljs-meta">@discardableResult</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">onRedo</span><span class="hljs-params">(<span class="hljs-number">_</span> h: @escaping EventHandler)</span></span> -&gt; <span class="hljs-type">Self</span> {
        h_onRedo = h
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>
    }
    
    <span class="hljs-comment">/// this closure will be called when an undo command is performed</span>
    <span class="hljs-meta">@discardableResult</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">onUndo</span><span class="hljs-params">(<span class="hljs-number">_</span> h: @escaping EventHandler)</span></span> -&gt; <span class="hljs-type">Self</span> {
        h_onUndo = h
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>
    }
}

</code></pre>
</li>
<li>
<p>封装出Codable的线段、颜色、Texture作为基础元素，进一步组成笔刷和笔画。</p>
<pre class="highlight"><code class="swift"><span class="hljs-comment">/// a line strip with lines and brush info</span>
<span class="hljs-keyword">open</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LineStrip</span>: <span class="hljs-title">CanvasElement</span> </span>{
    
    <span class="hljs-comment">/// element index</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> index: <span class="hljs-type">Int</span> = <span class="hljs-number">0</span>
    
    <span class="hljs-comment">/// identifier of bursh used to render this line strip</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> brushName: <span class="hljs-type">String?</span>
    
    <span class="hljs-comment">/// default color</span>
    <span class="hljs-comment">// this color will be used when line's color not set</span>
    <span class="hljs-keyword">var</span> color: <span class="hljs-type">MLColor</span>
    
    <span class="hljs-comment">/// line units of this line strip</span>
    <span class="hljs-keyword">open</span> <span class="hljs-keyword">private</span>(<span class="hljs-keyword">set</span>) <span class="hljs-keyword">var</span> lines: [<span class="hljs-type">MLLine</span>] = []
    
    <span class="hljs-comment">/// brush used to render this line strip</span>
    <span class="hljs-keyword">open</span> <span class="hljs-keyword">internal</span>(<span class="hljs-keyword">set</span>) <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> brush: <span class="hljs-type">Brush?</span> {
        <span class="hljs-keyword">didSet</span> {
            brushName = brush?.name
        }
    }
    
    <span class="hljs-keyword">init</span>(lines: [<span class="hljs-type">MLLine</span>], brush: <span class="hljs-type">Brush</span>) {
        <span class="hljs-keyword">self</span>.lines = lines
        <span class="hljs-keyword">self</span>.brush = brush
        <span class="hljs-keyword">self</span>.brushName = brush.name
        <span class="hljs-keyword">self</span>.color = brush.renderingColor
        remakBuffer()
    }
    
    <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">append</span><span class="hljs-params">(lines: [MLLine])</span></span> {
        <span class="hljs-keyword">self</span>.lines.append(contentsOf: lines)
        vertex_buffer = <span class="hljs-literal">nil</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">drawSelf</span><span class="hljs-params">(on target: RenderTarget)</span></span> {
        brush?.render(lineStrip: <span class="hljs-keyword">self</span>, on: target)
    }
    
    <span class="hljs-comment">/// get vertex buffer for this line strip, remake if not exists</span>
    <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">retrieveBuffers</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-type">MTLBuffer?</span> {
        <span class="hljs-keyword">if</span> vertex_buffer == <span class="hljs-literal">nil</span> {
            remakBuffer()
        }
        <span class="hljs-keyword">return</span> vertex_buffer
    }
    
    <span class="hljs-comment">/// count of vertexes, set when remake buffers</span>
    <span class="hljs-keyword">open</span> <span class="hljs-keyword">private</span>(<span class="hljs-keyword">set</span>) <span class="hljs-keyword">var</span> vertexCount: <span class="hljs-type">Int</span> = <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> vertex_buffer: <span class="hljs-type">MTLBuffer?</span>
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">remakBuffer</span><span class="hljs-params">()</span></span> {
        
        <span class="hljs-keyword">guard</span> lines.<span class="hljs-built_in">count</span> &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span>
        }
        
        <span class="hljs-keyword">var</span> vertexes: [<span class="hljs-type">Point</span>] = []
        
        lines.forEach { (line) <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">let</span> scale = brush?.target?.contentScaleFactor ?? <span class="hljs-type">UIScreen</span>.main.nativeScale
            <span class="hljs-keyword">var</span> line = line
            line.begin = line.begin * scale
            line.end = line.end * scale
            <span class="hljs-keyword">let</span> <span class="hljs-built_in">count</span> = <span class="hljs-built_in">max</span>(line.length / line.pointStep, <span class="hljs-number">1</span>)
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> ..&lt; <span class="hljs-type">Int</span>(<span class="hljs-built_in">count</span>) {
                <span class="hljs-keyword">let</span> index = <span class="hljs-type">CGFloat</span>(i)
                <span class="hljs-keyword">let</span> x = line.begin.x + (line.end.x - line.begin.x) * (index / <span class="hljs-built_in">count</span>)
                <span class="hljs-keyword">let</span> y = line.begin.y + (line.end.y - line.begin.y) * (index / <span class="hljs-built_in">count</span>)
                vertexes.append(<span class="hljs-type">Point</span>(x: x, y: y, color: line.color ?? color, size: line.pointSize * scale))
            }
        }
        
        vertexCount = vertexes.<span class="hljs-built_in">count</span>
        vertex_buffer = sharedDevice?.makeBuffer(bytes: vertexes, length: <span class="hljs-type">MemoryLayout</span>&lt;<span class="hljs-type">Point</span>&gt;.<span class="hljs-built_in">stride</span> * vertexCount, options: .cpuCacheModeWriteCombined)
    }
    
    <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">CodingKeys</span>: <span class="hljs-title">String</span>, <span class="hljs-title">CodingKey</span> </span>{
        <span class="hljs-keyword">case</span> index
        <span class="hljs-keyword">case</span> brush
        <span class="hljs-keyword">case</span> lines
        <span class="hljs-keyword">case</span> color
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">required</span> <span class="hljs-keyword">init</span>(from decoder: <span class="hljs-type">Decoder</span>) <span class="hljs-keyword">throws</span> {
        <span class="hljs-keyword">let</span> container = <span class="hljs-keyword">try</span> decoder.container(keyedBy: <span class="hljs-type">CodingKeys</span>.<span class="hljs-keyword">self</span>)
        index = <span class="hljs-keyword">try</span> container.decode(<span class="hljs-type">Int</span>.<span class="hljs-keyword">self</span>, forKey: .index)
        brushName = <span class="hljs-keyword">try</span> container.decode(<span class="hljs-type">String</span>.<span class="hljs-keyword">self</span>, forKey: .brush)
        lines = <span class="hljs-keyword">try</span> container.decode([<span class="hljs-type">MLLine</span>].<span class="hljs-keyword">self</span>, forKey: .lines)
        color = <span class="hljs-keyword">try</span> container.decode(<span class="hljs-type">MLColor</span>.<span class="hljs-keyword">self</span>, forKey: .color)
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">encode</span><span class="hljs-params">(to encoder: Encoder)</span></span> <span class="hljs-keyword">throws</span> {
        <span class="hljs-keyword">var</span> container = encoder.container(keyedBy: <span class="hljs-type">CodingKeys</span>.<span class="hljs-keyword">self</span>)
        <span class="hljs-keyword">try</span> container.encode(index, forKey: .index)
        <span class="hljs-keyword">try</span> container.encode(brushName, forKey: .brush)
        <span class="hljs-keyword">try</span> container.encode(lines, forKey: .lines)
        <span class="hljs-keyword">try</span> container.encode(color, forKey: .color)
    }
}
</code></pre>
</li>
<li>
<p>利用着色器进行渲染，并在笔画有删改的时候更新图形管线，重新进行绘制。</p>
</li>
<li>
<p>白色笔刷用于生成蒙板，其它颜色的笔刷作为涂鸦工具在蒙板上进行简单绘制。</p>
</li>
</ul>
<p>完成绘制后，将数据上传至服务器，通过计算生成结果图片以及URL，通过URL获取生成结果。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/04/Comprehension-of-SDWebImage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Wenjie Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aven's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/04/Comprehension-of-SDWebImage/" class="post-title-link" itemprop="url">Comprehension of SDWebImage</a>
        </h1>

        <div class="post-meta">

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1><span id="对sdwebimage的理解"> 对SDWebImage的理解</span></h1>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/21/Image-completion-with-generative-adversarial-networks/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Wenjie Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aven's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/21/Image-completion-with-generative-adversarial-networks/" class="post-title-link" itemprop="url">GAN in Editing Portrait</a>
        </h1>

        <div class="post-meta">

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>前段时间看了一篇论文，是生成对抗网络在人像编辑方面的应用，以这个模型为核心跟队友摸鱼写了一个以用户的直接涂改，包括表示修改区域的蒙板、修改笔迹、颜色作为输入的智能人像编辑iPad应用。以下是对文章原理和提供方法的一个简述。</p>
<!-- toc -->
<ul>
<li><a href="#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86">背景知识</a>
<ul>
<li><a href="#gan%E5%8E%9F%E7%90%86%E7%AE%80%E8%BF%B0">GAN原理简述</a></li>
<li><a href="#%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%9C%A8%E4%BA%BA%E5%83%8F%E7%BC%96%E8%BE%91%E7%9A%84%E5%BA%94%E7%94%A8">深度学习在人像编辑的应用</a>
<ul>
<li><a href="#%E5%B7%A5%E4%BD%9C%E7%AE%80%E8%BF%B0">工作简述</a></li>
<li><a href="#%E5%9B%BE%E5%83%8F%E7%BF%BB%E8%AF%91">图像翻译</a></li>
<li><a href="#%E5%9B%BE%E5%83%8F%E5%AE%8C%E6%88%90">图像完成</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">解决方案</a>
<ul>
<li><a href="#%E8%AE%AD%E7%BB%83%E6%95%B0%E6%8D%AE">训练数据</a></li>
<li><a href="#%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84">网络结构</a>
<ul>
<li><a href="#%E7%94%9F%E6%88%90%E5%99%A8">生成器</a></li>
<li><a href="#%E5%88%A4%E5%88%AB%E5%99%A8">判别器</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- tocstop -->
<h1><span id="背景知识"> 背景知识</span></h1>
<h2><span id="gan原理简述"> GAN原理简述</span></h2>
<p>顾名思义，GAN，即生成对抗网络，是由生成器和判别器构成的一种深度学习模型。以人像编辑软件为例，图像生成器的目的是接收用户的涂改作为输入，合成修改后的图片。图像判定器负责判断合成的图片看上去是真的还是假的。而生成模型的训练，就是通过生成器生成图片，判别器做出判断，生成器改进，继续生成图片……直到判别器分辨不出接收到的是一张真实的图片还是由用户提交的修改的图片。</p>
<h2><span id="深度学习在人像编辑的应用"> 深度学习在人像编辑的应用</span></h2>
<h3><span id="工作简述"> 工作简述</span></h3>
<p>深度学习已经可以应用于恢复图像中被擦除的部分。最经典的方法就是使用一个方形的蒙板，使用编码-解码生成器恢复蒙板区域的图像，图像是否真实的判断由一个全局本地判别器来判定。但是这种方法的缺点就是较低的图像解析程度，并且由于方形的蒙板导致生成的图像在蒙板区域有一个尴尬的边界。除此之外，生成器不能接收用户的输入，降低了用户友好度。</p>
<p>其它改进的方式包括Deepfillv2(引入用户输入来恢复缺失部分)，Guided-Inpating(使用其它图片的部分来恢复被删除的部分)。一些其它的工作如Ideepcolor提出了一个能够接受用户输入作为参考，创建彩色图像；FaceShop可接受笔画和颜色同时作为用户输入。但这些方法都有着不同程度的用户交互短板，甚至不尽人意的完成效果。</p>
<p>为克服这些缺点，这篇文章提出了一种完全卷积神经网络的SC-FEGAN，用于进行端到端训练。该网络利用SN-patchGAN判别器克服尴尬的边界；利用通用的GAN损失和新增的style损失来编辑脸部图像；复合出的图片具有高质量的真实性；具有高度自由的用户输入形式。</p>
<h3><span id="图像翻译"> 图像翻译</span></h3>
<p>用于图像翻译的GAN是在用于学习在两个数据集之间进行图像区域转换。该数据集由一对图像组成，可用于创建将分割标签转换为原始图像，或将草图转换为图像，或将黑白图像转换为彩色图像。但是该系统要求图像和目标图像必须成对存在于训练数据集中，以便学习域之间的转换。给定目标域而没有目标图像，则在原始域中转换图像时，目标域中会存在虚拟结果。如果虚拟结果再次反转，则反转的结果必须是原始图像。因此，转换任务需要两个生成器。</p>
<h3><span id="图像完成"> 图像完成</span></h3>
<p>图像完成领域面临两个主要挑战：</p>
<ol>
<li>填充图像的已删除区域</li>
<li>在恢复区域中正确反映用户输入。</li>
</ol>
<h1><span id="解决方案"> 解决方案</span></h1>
<h2><span id="训练数据"> 训练数据</span></h2>
<p>适当的训练数据对于提高网络的训练性能和提高对用户输入的响应能力非常重要。为了训练模型，使用了CelebA-HQ 数据集。预处理步骤如下：</p>
<ol>
<li>随机选取包含29000张图片的集合作为训练数据集，1000张图片作为测试数据集。</li>
<li>在获得草图和颜色数据集之前，我们将图像调整为512×512像素。</li>
<li>为了更好地表达人脸图像中眼睛的复杂性，我们使用了基于眼睛位置的自由蒙板来训练网络</li>
<li>通过使用自由形式的蒙版和面部分割GFC创建了适当的草图域和颜色域。</li>
</ol>
<p>关键设计如下：</p>
<ol>
<li>
<p>带有眼睛位置的自由蒙版</p>
<p>我们使用了类似于Deepfillv2的方法，即采用蒙板的方式，然后利用用户在蒙板上的输入生成不完全的图像，此外，在用面部图像训练时，随机使用以眼睛位置为起点的自由绘制蒙版来表达眼睛的复杂部分。另外，头发的蒙板采用了GFC，细节如下算法表述的那样：</p>
<pre class="highlight"><code class>maxDraw, maxLine, maxAngle, maxLength are hyper
parameters
GFCHair is the GFC for get hair mask of input image Mask=zeros(inputSize,inputSize) HairMask=GFCHair(IntputImage) numLine=random.range(maxDraw)
for i=0 to numLine do
startX = random.range(inputSize) startY = random.range(inputSize) startAngle = random.range(360) numV = random.range(maxLine) for j=0 to numV do
angleP = random.range(-maxAngle,maxAngle) if j is even then
angle = startAngle+angleP
else
angle = startAngle+angleP+180
end if
length = random.range(maxLength)
Draw a line on Mask from point (startX, startY) with angle and length.
startX = startX + length * sin(angle)
startY = stateY + length * cos(angle)
end for
Draw a line on Mask from eye postion randomly.
end for
Mask = Mask + HairMask (randomly)
</code></pre>
</li>
<li>
<p>草图、颜色域</p>
<p>1）用HED边缘检测器生成草图数据，该数据对应于用户输入以修改面部图像。</p>
<p>2）之后，使曲线平滑并消除了小边缘。为了创建色域数据，首先通过应用大小为3的中值过滤，然后应用20个双边过滤器来创建模糊图像。</p>
<p>3）之后，使用GFC分割人脸，并将每个分割的部分替换为相应部分的中间颜色。</p>
<p>4）在为色域创建数据时，未应用直方图均衡，以避免光反射和阴影污染颜色。但是，由于用户更愿意在草图域中表达面部的所有部分，而不受光干扰引起的模糊影响，因此在从主体数据创建草图时使用了直方图均衡化。</p>
</li>
</ol>
<h2><span id="网络结构"> 网络结构</span></h2>
<p>用于图像补充的生成器网络基于编码器-解码器架构，判别器网络则是基于SN-patchGAN结构。这样的网络结构能够快速训练以达稳定，并且生成高质量的大小为512*512的合成图片。训练时，生成器和判别器同时进行。**生成器接收带用户输入的不完整图片，输出带RGB通道的图片，并将蒙板区域的输出图像插入到输入图片中，由此来创建一张完整的图片。**详细网络结构如下图所示：</p>
<p><img src="./Image-completion-with-generative-adversarial-networks/structure.png" alt></p>
<img src="/2019/07/21/Image-completion-with-generative-adversarial-networks/structure.png" class>
<h3><span id="生成器"> 生成器</span></h3>
<p>生成器基于U-net，即编码器-解码器结构。编码器接收尺寸为512×512×9的输入张量，即一个不完整的RGB通道图像，其中有一个要编辑的去除区域，一个二进制草图（描述了去除部分的结构），一个RGB色彩笔划图，一个二进制蒙版和噪音，见下图</p>
<p><img src="./Image-completion-with-generative-adversarial-networks/input.png" alt></p>
<img src="/2019/07/21/Image-completion-with-generative-adversarial-networks/input.png" class>
<p>编码器使用2个步幅内核卷积对输入进行7次下采样，然后在上采样之前进行膨胀卷积。解码器使用转置卷积进行上采样。然后，添加了跳过连接以允许以相同的空间分辨率与上一层连接。除了输出层使用tanh函数外，在每层之后都使用了泄漏的ReLU激活函数。总体而言，生成器由16个卷积层组成，网络的输出是输入大小相同（512×512）的RGB图像。在将损失函数应用到输入之前，我们用输入图像替换了蒙板之外的图像的其余部分。这种替换使生成器仅在已编辑区域上受到训练。生成器接受了每像素损失，感知损失，样式损失和总方差损失这些损失训练，还使用通用GAN损失函数。</p>
<h3><span id="判别器"> 判别器</span></h3>
<p>判别器具有SN-PatchGAN 结构，它的特性是没有对GAN损失应用ReLu函数。另外还使用了3×3大小的卷积内核并应用了梯度损失。整体损失函数计算如下所示：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mrow><mi>G</mi><mi>S</mi><mi>N</mi></mrow></msub><mo>=</mo><mo>−</mo><mi>I</mi><mi>E</mi><mo>[</mo><mi>D</mi><mo>(</mo><msub><mi>I</mi><mrow><mi>c</mi><mi>o</mi><mi>m</mi><mi>p</mi></mrow></msub><mo>)</mo><mo>]</mo></mrow><annotation encoding="application/x-tex">L_{GSN} = -IE[D(I_{comp})]
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">G</span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord">−</span><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07847em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">m</span><span class="mord mathit">p</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mclose">]</span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mi>G</mi></msub><mo>=</mo><msub><mi>L</mi><mrow><mi>p</mi><mi>e</mi><mi>r</mi><mo>−</mo><mi>p</mi><mi>i</mi><mi>x</mi><mi>e</mi><mi>l</mi></mrow></msub><mo>+</mo><mi>σ</mi><msub><mi>L</mi><mrow><mi>p</mi><mi>e</mi><mi>r</mi><mi>c</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow></msub><mo>+</mo><mi>β</mi><msub><mi>L</mi><mrow><msub><mi>G</mi><mi>S</mi></msub><mi>N</mi></mrow></msub><mo>+</mo><mi>γ</mi><mo>(</mo><msub><mi>L</mi><mrow><mi>s</mi><mi>t</mi><mi>y</mi><mi>l</mi><mi>e</mi></mrow></msub><mo>(</mo><msub><mi>I</mi><mrow><mi>g</mi><mi>e</mi><mi>n</mi></mrow></msub><mo>)</mo><mo>+</mo><msub><mi>L</mi><mrow><mi>s</mi><mi>t</mi><mi>y</mi><mi>l</mi><mi>e</mi></mrow></msub><mo>(</mo><msub><mi>I</mi><mrow><mi>c</mi><mi>o</mi><mi>m</mi><mi>p</mi></mrow></msub><mo>)</mo><mo>)</mo><mo>+</mo><mi>υ</mi><msub><mi>L</mi><mrow><mi>t</mi><mi>υ</mi></mrow></msub><mo>+</mo><mi>ϵ</mi><mi>I</mi><mi>E</mi><mo>[</mo><mi>D</mi><mo>(</mo><msub><mi>I</mi><mrow><mi>g</mi><mi>t</mi></mrow></msub><msup><mo>)</mo><mn>2</mn></msup><mo>]</mo></mrow><annotation encoding="application/x-tex">L_G = L_{per-pixel}+\sigma L_{percent}+\beta L_{G_SN}+ \gamma (L_{style}(I_{gen})+L_{style}(I_{comp}))+\upsilon L_{t\upsilon}+\epsilon IE[D(I_{gt})^2]
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8641079999999999em;"></span><span class="strut bottom" style="height:1.150216em;vertical-align:-0.286108em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">G</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">p</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mbin">−</span><span class="mord mathit">p</span><span class="mord mathit">i</span><span class="mord mathit">x</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.03588em;">σ</span><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">p</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">c</span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mord mathit">t</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.05278em;">β</span><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15000000000000002em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord"><span class="mord mathit">G</span><span class="vlist"><span style="top:0.15em;margin-right:0.07142857142857144em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord mathit" style="margin-right:0.05764em;">S</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.05556em;">γ</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07847em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">e</span><span class="mord mathit">n</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mbin">+</span><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07847em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">m</span><span class="mord mathit">p</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.03588em;">υ</span><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.03588em;">υ</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord mathit">ϵ</span><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07847em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">t</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose"><span class="mclose">)</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">]</span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mi>D</mi></msub><mo>=</mo><mi>I</mi><mi>E</mi><mo>[</mo><mn>1</mn><mo>−</mo><mi>D</mi><mo>(</mo><msub><mi>I</mi><mrow><mi>g</mi><mi>t</mi></mrow></msub><mo>)</mo><mo>]</mo><mo>+</mo><mi>I</mi><mi>E</mi><mo>[</mo><mn>1</mn><mo>+</mo><mi>D</mi><mo>(</mo><msub><mi>I</mi><mrow><mi>c</mi><mi>o</mi><mi>m</mi><mi>p</mi></mrow></msub><mo>)</mo><mo>]</mo><mo>+</mo><mi>θ</mi><msub><mi>L</mi><mrow><mi>G</mi><mi>P</mi></mrow></msub></mrow><annotation encoding="application/x-tex">L_D = IE[1-D(I_{gt})]+IE[1+D(I_{comp})]+\theta L_{GP}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mopen">[</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07847em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mord mathit">t</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mclose">]</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mopen">[</span><span class="mord mathrm">1</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07847em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">m</span><span class="mord mathit">p</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mclose">]</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">G</span><span class="mord mathit" style="margin-right:0.13889em;">P</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></p>
<p>生成器用<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mi>G</mi></msub></mrow><annotation encoding="application/x-tex">L_G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">G</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>训练，判别器用<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mi>D</mi></msub></mrow><annotation encoding="application/x-tex">L_D</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>训练，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi><mo>(</mo><mi>I</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">D(I)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="mclose">)</span></span></span></span>是判别器的输出，其中<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>I</mi></mrow><annotation encoding="application/x-tex">I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.07847em;">I</span></span></span></span>为输入；在编辑较大的区域比如头发时，损失<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mrow><mi>s</mi><mi>t</mi><mi>y</mi><mi>l</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">L_{style}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>和<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mrow><mi>p</mi><mi>e</mi><mi>r</mi><mi>c</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">L_{percent}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">L</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">p</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">c</span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mord mathit">t</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>十分关键，</p>
<h2><span id> </span></h2>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/20/ARTMM%E5%BB%BA%E6%A8%A1%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Wenjie Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aven's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/20/ARTMM%E5%BB%BA%E6%A8%A1%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">ARTMM建模笔记</a>
        </h1>

        <div class="post-meta">

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1><span id="洋流节点建模信息"> 洋流节点建模信息</span></h1>
<ol>
<li>
<p>洋流分层，旋转；因此垂直运动相对水平运动是微不足道的</p>
</li>
<li>
<p>任何不可压缩的二维流由函数描述（需要自己建模），其中：</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi><mo>=</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mrow><mi>ψ</mi></mrow></mrow><mrow><mi mathvariant="normal">∂</mi><mrow><mi>y</mi></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">u = \frac{\partial{\psi}}{\partial{y}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.9322159999999999em;"></span><span class="strut bottom" style="height:1.4133239999999998em;vertical-align:-0.481108em;"></span><span class="base textstyle uncramped"><span class="mord mathit">u</span><span class="mrel">=</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathrm" style="margin-right:0.05556em;">∂</span><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.44610799999999995em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm" style="margin-right:0.05556em;">∂</span><span class="mord scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">ψ</span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span>, 为向东的流速</li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi><mo>=</mo><mfrac><mrow><mi mathvariant="normal">∂</mi><mrow><mi>ψ</mi></mrow></mrow><mrow><mi mathvariant="normal">∂</mi><mrow><mi>x</mi></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">v = \frac{\partial{\psi}}{\partial{x}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.9322159999999999em;"></span><span class="strut bottom" style="height:1.277216em;vertical-align:-0.345em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mrel">=</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathrm" style="margin-right:0.05556em;">∂</span><span class="mord scriptstyle cramped"><span class="mord mathit">x</span></span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.44610799999999995em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm" style="margin-right:0.05556em;">∂</span><span class="mord scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">ψ</span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span>, 为向北的流速</li>
</ul>
</li>
<li>
<p>随洋流的传感器轨迹为是以下哈密顿常微分方程系统的解</p>
</li>
<li>
<p>所有水下节点拥有相同的计算能力、交流能力、存储能力</p>
</li>
<li>
<p>网络是一个多跳网络：只有当两个传感器节点相互进入通信范围时，它们才能相互检测并开始通信。在任何两个节点之间交换的分组（不在彼此的通信范围内）由其他转发节点转发。</p>
</li>
<li>
<p>不可靠信道：两个相邻节点即使在彼此的通信范围内也不能总是彼此接收分组。</p>
</li>
<li>
<p>信任值范围0-1，阈值为0.5，初始信任值为0.5</p>
</li>
</ol>
<blockquote>
<p>注：更多参考信息：</p>
<p>A. Caruso, F. Paparella, L. Vieira, M. Erol, and M. Gerla, “The meandering current mobility model and its impact on underwater mobile sensor networks,” in Proc. 27th Conf. Comput. Commun., Apr. 2008, pp. 1–9.</p>
</blockquote>
<h1><span id="arttm基本架构"> ARTTM基本架构</span></h1>
<p>理解传输数据，参与传感器节点和通信链路之间的关系</p>
<h2><span id="相互依赖性"> 相互依赖性</span></h2>
<p>数据的信任值不仅基于参与的传感器节点的信任，而且还受链路质量的影响。</p>
<p><img src="./ARTMM%E5%BB%BA%E6%A8%A1%E7%AC%94%E8%AE%B0/artmm_archi.png" alt></p>
<img src="/2019/07/20/ARTMM%E5%BB%BA%E6%A8%A1%E7%AC%94%E8%AE%B0/artmm_archi.png" class>
<p>如上图所示，ARTMM由三个主要部分组成：链路信任，数据信任和节点信任。节点信任和链路信任确定数据的可信度。数据信任反映了相关节点和通信链路的可靠性。链路信任基于链路质量和链路容量进行评估。</p>
<p>链路质量反映了通信信道的性能，其基于分组丢失的预测和分组错误的计算来评估。链路容量定义为链路的使用率，即链路已被使用的次数的比率。</p>
<p>节点信任基于节点诚实和节点能力来计算。节点诚实度是指一个传感器节点认为其邻居节点基于其通信行为（成功和不成功的通信）是诚实的。节点能力意味着传感器节点是否具有足够的能量来执行其预期功能，因此它是基于传感器节点的能量消耗来计算的。</p>
<p>基于链接信任和节点信任，我们可以通过相似性和正确性检测方法最终获得数据的可信度</p>
<h2><span id="滑动时间窗口"> 滑动时间窗口</span></h2>
<p>由于动态水下环境，应考虑历史信任值以动态更新可信度。为了解决这个问题，我们采用滑动时间窗口概念来更新信任值如下：</p>
<ol>
<li>每个时间窗口由几个单元组成</li>
<li>在每个时间窗口期间，在两个相邻节点之间交换的分组，因此<strong>成功和不成功通信的数量以及传感器节点的剩余能量</strong>都记录在邻居列表中。</li>
<li>分别计算通信链路，节点和数据的当前信任值。</li>
<li>经过一段时间后，窗口向前滑动一个时间单位。然后，在下一个时间窗口中，把历史信任值用于更新新信任值，之后丢弃</li>
</ol>
<blockquote>
<p>小结：</p>
</blockquote>
<p>ARTMM包含两个步骤：每个时间窗口中的当前信任计算和基于历史信任值的信任更新。</p>
<h1><span id="信任值计算"> 信任值计算</span></h1>
<h2><span id="链路信任值计算"> 链路信任值计算</span></h2>
<p><img src="./ARTMM%E5%BB%BA%E6%A8%A1%E7%AC%94%E8%AE%B0/link_trust_evaluation.png" alt></p>
<img src="/2019/07/20/ARTMM%E5%BB%BA%E6%A8%A1%E7%AC%94%E8%AE%B0/link_trust_evaluation.png" class>
<p>PLR: packet loss rate</p>
<h3><span id="包错误率计算"> 包错误率计算</span></h3>
<h4><span id="计算传输损失"> 计算传输损失</span></h4>
<p>基于射线理论的多径瑞利水下航道模型：</p>
<p>浅水和深水的传输损失是：</p>
<ul>
<li>
<p>浅水：</p>
</li>
<li>
<p>深水：</p>
<p>其中，和分别代表浅水和深水中的吸收系数（衰减系数），代表传输范围。</p>
<p>注：吸收系数计算：M. C. Domingo, “Overview of channel models for underwater wireless communication networks,” Phys. Commun., vol. 1, pp. 163–182, 2008.</p>
<h4><span id="计算snr"> 计算SNR</span></h4>
<p>不考虑干扰，比特误码率(BER)可由信噪比计算得出，基于被动声纳方程，SNR在接收器处发射的水下信号为：</p>
<p>其中为探测阈值，为源级，为**传输损失(**上小节)，为噪音级别，为指向性指数</p>
<h4><span id="计算ber"> 计算BER</span></h4>
<p>所选的调制方法也会影响BER，如16QAM的BER：</p>
<p>其中, 为噪声带宽，R为数据的速率（data rate）</p>
<h4><span id="计算per"> 计算PER</span></h4>
<p>其中n代表包中的比特数</p>
<h4><span id="考虑声道干扰的per"> 考虑声道干扰的PER</span></h4>
<p>使用前向纠错，考虑块码来提升前向纠错的效率并降低其复杂度。对于一个块码, 可得到它的块错误率(BLER)为：</p>
<p>其中，是块码的长度，是比特的纠错能力</p>
<p><strong>PER计算更正为</strong>：</p>
<p>其中N是数据包中的有效负载数</p>
<!--有效负载数-->：当通过因特网发送数据时，发送的每个单元包括头信息和发送的实际数据。标头标识数据包的源和目标，而实际数据称为有效负载。
<h3><span id="包丢失率计算"> 包丢失率计算</span></h3>
<h4><span id="prr计算"> PRR计算</span></h4>
<ol>
<li>
<p>最近最大权重的PRR：</p>
<p>漏洞：选择性转发攻击</p>
</li>
<li>
<p>最小化噪声和干扰影响的PRR：</p>
<p>每个时间窗口T中，在声学信道上的分组丢失可以被视为一组随机时间序列。基于ARIMA模型，时间序列的历史数据可用于预测未来数据值</p>
<ol>
<li>使时间序列固定。被分析的时间序列必须是静止的。如果原始时间序列是非静止的，则必须通过差分对其进行变换以使序列静止</li>
<li>确定预测模型。 ARIMA模型由三个部分组成：自回归（AR），移动平均（MA）和ARMA。首先，确定静止时间序列的自相关函数（ACF）和部分自相关函数（PACF）。如果静止序列的PACF被截断并且ACF拖尾，则选择AR模型。如果静止序列的ACF显示急剧截止且PACF拖尾，则选择MA模型。否则，ARMA模型用于预测未来的数据值。</li>
<li>估计ARIMA模型参数</li>
<li>诊断ARIMA残留序列。此步骤使用白噪声测试来检查剩余时间序列是否包含其他有用信息。在这种情况下，必须通过重复步骤3和4继续分析，直到找到通过白噪声测试的适当ARIMA模型。</li>
<li>选择最合适的ARIMA模型来预测信任值。它假定在网络部署阶段的最初阶段没有恶意攻击。因此，我们可以根据公式（4）得到初始丢包率。</li>
</ol>
</li>
</ol>
<h3><span id="链路质量计算"> 链路质量计算</span></h3>
<p>然后，通过使用上述ARIMA模型，可以预测每个时间窗口中由不可靠通信信道引起的实际分组丢失。基于等式（2）和（4），通过计算链路质量：</p>
<h3><span id="链路容量lclclc计算"> 链路容量<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>c</mi></mrow><annotation encoding="application/x-tex">lc</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">c</span></span></span></span>计算</span></h3>
<h4><span id="lclclc定义"> <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>c</mi></mrow><annotation encoding="application/x-tex">lc</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">c</span></span></span></span>定义</span></h4>
<p>链路使用越多越可靠，可以从传感器节点的路由表条目中提取最大可能的使用次数，因此：</p>
</li>
</ul>
  lc = \frac{n{use}}{N{use}}\tag{6}

<p>其中<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mrow><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">n_{use}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">n</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">u</span><span class="mord mathit">s</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>是在当前时间窗口中已经使用链接的次数，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>N</mi><mrow><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">N_{use}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.10903em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">u</span><span class="mord mathit">s</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>是可以使用链接的最大可能次数</p>
<p>缺点：DoS攻击可能改变通信链路的使用次数</p>
<h4><span id="改进的lclclc"> 改进的<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>c</mi></mrow><annotation encoding="application/x-tex">lc</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">c</span></span></span></span></span></h4>
<p>在没有恶意节点的普通UASN中，所有传感器节点的所有流量负载均衡，以延长网络生命周期，从而稳定地使用每个通信链路。因此，链接容量重写为：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mi>c</mi><mo>(</mo><mi>i</mi><mo>)</mo><mo>=</mo><mrow><mo fence="true">{</mo><mtable><mtr><mtd><mrow></mrow></mtd><mtd><mrow><mrow></mrow><mfrac><mrow><msub><mi>n</mi><mrow><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mo>(</mo><mi>i</mi><mo>)</mo></mrow><mrow><msub><mi>N</mi><mrow><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mo>(</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo>)</mo></mrow></mfrac><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mi>i</mi><mi>f</mi><mi mathvariant="normal">∣</mi><msub><mi>n</mi><mrow><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mo>(</mo><mi>i</mi><mo>)</mo><mo>−</mo><msub><mi>n</mi><mrow><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mo>(</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo>)</mo><mi mathvariant="normal">∣</mi><mo>≥</mo><mi>θ</mi></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd><mtd><mrow><mrow></mrow><mi>l</mi><mi>c</mi><mo>(</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo>)</mo><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>w</mi><mi>i</mi><mi>s</mi><mi>e</mi></mrow></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">  lc(i) = \left\{
  \begin{aligned}
  &amp;\frac{n_{use}(i)}{N_{use}(i-1)}, &amp;if|n_{use}(i)-n_{use}(i-1)|\geq \theta\\
  &amp;lc(i-1), &amp;otherwise
  \end{aligned}
  \right.
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:2.05002em;"></span><span class="strut bottom" style="height:3.60004em;vertical-align:-1.55002em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">c</span><span class="mopen">(</span><span class="mord mathit">i</span><span class="mclose">)</span><span class="mrel">=</span><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:0.65001em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:-0.000010000000000065512em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-1.15002em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist"><span style="top:-0.6045000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span style="top:1.1714999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="col-align-l"><span class="vlist"><span style="top:-0.6045000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"></span><span class="mord reset-textstyle displaystyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mord"><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.10903em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">u</span><span class="mord mathit">s</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">i</span><span class="mbin">−</span><span class="mord mathrm">1</span><span class="mclose">)</span></span></span></span><span style="top:-0.2300000000000001em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.677em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord"><span class="mord mathit">n</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">u</span><span class="mord mathit">s</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">i</span><span class="mclose">)</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mpunct">,</span></span></span><span style="top:1.1714999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"></span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">c</span><span class="mopen">(</span><span class="mord mathit">i</span><span class="mbin">−</span><span class="mord mathrm">1</span><span class="mclose">)</span><span class="mpunct">,</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:2em;"></span><span class="col-align-r"><span class="vlist"><span style="top:-0.6045000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">i</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathrm">∣</span><span class="mord"><span class="mord mathit">n</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">u</span><span class="mord mathit">s</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">i</span><span class="mclose">)</span><span class="mbin">−</span><span class="mord"><span class="mord mathit">n</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">u</span><span class="mord mathit">s</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">i</span><span class="mbin">−</span><span class="mord mathrm">1</span><span class="mclose">)</span><span class="mord mathrm">∣</span><span class="mrel">≥</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span><span style="top:1.1714999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">o</span><span class="mord mathit">t</span><span class="mord mathit">h</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="mord mathit">i</span><span class="mord mathit">s</span><span class="mord mathit">e</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span></span></p>
<p>其中<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mrow><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mo>(</mo><mi>i</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">n_{use}(i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">n</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">u</span><span class="mord mathit">s</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">i</span><span class="mclose">)</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mrow><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mo>(</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">n_{use}(i-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">n</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">u</span><span class="mord mathit">s</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">i</span><span class="mbin">−</span><span class="mord mathrm">1</span><span class="mclose">)</span></span></span></span>指的是当前和上一次时间窗口中已使用链接的次数。<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span></span>是定义的阈值，当链路的使用保持稳定即：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">∣</mi><msub><mi>n</mi><mrow><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mo>(</mo><mi>i</mi><mo>)</mo><mo>−</mo><msub><mi>n</mi><mrow><mi>u</mi><mi>s</mi><mi>e</mi></mrow></msub><mo>(</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo>)</mo><mi mathvariant="normal">∣</mi><mo>&lt;</mo><mi>θ</mi></mrow><annotation encoding="application/x-tex">|n_{use}(i)-n_{use}(i-1)|&lt; \theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">∣</span><span class="mord"><span class="mord mathit">n</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">u</span><span class="mord mathit">s</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">i</span><span class="mclose">)</span><span class="mbin">−</span><span class="mord"><span class="mord mathit">n</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">u</span><span class="mord mathit">s</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">i</span><span class="mbin">−</span><span class="mord mathrm">1</span><span class="mclose">)</span><span class="mord mathrm">∣</span><span class="mrel">&lt;</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span></span></p>
<p>我们能确信这个链路用得越多越稳定，否则，该通信链路可能受到恶意攻击。</p>
<h3><span id="链路信任值计算"> 链路信任值计算</span></h3>
<p>链路信任取决于链路质量和链路容量:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>l</mi><mi>i</mi><mi>n</mi><mi>k</mi></mrow></msub><mo>=</mo><mrow><mo fence="true">{</mo><mtable><mtr><mtd><mrow></mrow></mtd><mtd><mrow><mrow></mrow><mn>0</mn><mi mathvariant="normal">.</mi><mn>5</mn><mo>+</mo><mo>(</mo><mi>l</mi><mi>q</mi><mo>−</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>5</mn><mo>)</mo><mo>×</mo><mi>l</mi><mi>c</mi><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mi>l</mi><mi>q</mi><mo>≥</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>5</mn></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd><mtd><mrow><mrow></mrow><mi>l</mi><mi>q</mi><mo>×</mo><mi>l</mi><mi>c</mi><mo separator="true">,</mo></mrow></mtd><mtd><mrow><mi>l</mi><mi>q</mi><mo>&lt;</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>5</mn></mrow></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">  T_{link} = \left\{
  \begin{aligned}
  &amp;0.5+(lq-0.5)\times lc, &amp;lq \geq 0.5\\
  &amp;lq \times lc, &amp;lq &lt; 0.5
  \end{aligned}
  \right.
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.45em;"></span><span class="strut bottom" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size3">{</span></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="col-align-l"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"></span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">5</span><span class="mbin">+</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="mbin">−</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">5</span><span class="mclose">)</span><span class="mbin">×</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">c</span><span class="mpunct">,</span></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"></span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="mbin">×</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">c</span><span class="mpunct">,</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:2em;"></span><span class="col-align-r"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="mrel">≥</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">5</span></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="mrel">&lt;</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">5</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span></span></p>
<h2><span id="数据信任值计算"> 数据信任值计算</span></h2>
<p>数据信任是对容错和数据一致性的信任评估。通常已知发送的数据信息是时间和空间相关性。在某个时间段内，相邻节点之间关于同一事件的感知数据信息总是彼此相似。数据信息的数值始终遵循某些特定分布，例如正态分布。为简单起见，假设数据项的分布服从正态分布。数据项的概率密度函数可以通过计算<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo>)</mo><mo>=</mo><mfrac><mrow><mn>1</mn></mrow><mrow><mi>σ</mi><msqrt><mrow><mn>2</mn><mi>π</mi></mrow></msqrt></mrow></mfrac><msup><mi>e</mi><mrow><mo>−</mo><mfrac><mrow><mo>(</mo><mi>x</mi><mo>−</mo><mi>μ</mi><msup><mo>)</mo><mn>2</mn></msup></mrow><mrow><mn>2</mn><msup><mi>σ</mi><mn>2</mn></msup></mrow></mfrac></mrow></msup></mrow><annotation encoding="application/x-tex">f(x) = \frac{1}{\sigma\sqrt{2\pi}}e^{-\frac{(x-\mu)^2}{2\sigma^2}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.32319em;"></span><span class="strut bottom" style="height:1.8731900000000001em;vertical-align:-0.55em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.470554em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03588em;">σ</span><span class="sqrt mord"><span class="sqrt-sign" style="top:-0.08650571428571419em;"><span class="style-wrap reset-scriptstyle scriptstyle uncramped">√</span></span><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1.4285714285714286em;">​</span></span><span class="mord scriptstyle cramped"><span class="mord mathrm">2</span><span class="mord mathit" style="margin-right:0.03588em;">π</span></span></span><span style="top:-0.8293628571428571em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1.4285714285714286em;">​</span></span><span class="reset-scriptstyle textstyle uncramped sqrt-line"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1.4285714285714286em;">​</span></span>​</span></span></span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.394em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord mathrm">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:1em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span><span class="mord"><span class="mord mathit">e</span><span class="vlist"><span style="top:-0.45947000000000005em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord">−</span><span class="mord reset-scriptstyle scriptstyle uncramped"><span class="sizing reset-size5 size5 reset-scriptstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.5024571428571429em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord scriptscriptstyle cramped"><span class="mord mathrm">2</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">σ</span><span class="vlist"><span style="top:-0.289em;margin-right:0.1em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptscriptstyle scriptscriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span style="top:-0.22142857142857142em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle textstyle uncramped frac-line"></span></span><span style="top:-0.5142857142857143em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle uncramped"><span class="mord scriptscriptstyle uncramped"><span class="mopen">(</span><span class="mord mathit">x</span><span class="mbin">−</span><span class="mord mathit">μ</span><span class="mclose"><span class="mclose">)</span><span class="vlist"><span style="top:-0.363em;margin-right:0.1em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptscriptstyle scriptscriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-scriptstyle textstyle uncramped nulldelimiter"></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>得到，其中<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">x</span></span></span></span>为数据项<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>v</mi><mi>d</mi></msub></mrow><annotation encoding="application/x-tex">v_d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">d</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>的数值，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>μ</mi></mrow><annotation encoding="application/x-tex">\mu</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit">μ</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>σ</mi></mrow><annotation encoding="application/x-tex">\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">σ</span></span></span></span>分别是数据的均值和方差。基于正态分布模型，观察到平均值<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">m</span></span></span></span>由数据信息的多数值确定，因此平均值被认为是能够很好地反映数据的值相似性的最具代表性的值。这意味着，对于一组数据，均值应该是具有最高信任值的。值越接近于均值，信任值越大，反之亦然。因此，数据信任值定义为：</p>
  T_{data} = 2\times(0.5-\int_\mu^{v_d}{f(x)dx}) = 2\int_{v_d}^\infty f(x)dx \tag{9}

<p>但是，如果存在数据修改攻击，则在出现不诚实的数据信息时，方程（9）无法正常工作。因此，我们首先使用<em>中值绝对偏差（MAD） - 中值规则</em>来消除异常值，然后平均剩余数据值并使用相似性来评估数据信任。</p>
<h2><span id="节点信任值计算"> 节点信任值计算</span></h2>
<p>通常，基于受试者的观察和第三方的推荐来计算传感器节点的信任值。但是收集和管理第三方推荐占用大量能耗，因此:</p>
<ol>
<li>检查对象和主题节点之间交换的分组的数量</li>
<li>如果它们之间交换的数据包的数量大于定义的阈值<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><msub><mi>h</mi><mrow><mi>n</mi><mi>u</mi><mi>m</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Th_{num}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mord"><span class="mord mathit">h</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span><span class="mord mathit">u</span><span class="mord mathit">m</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>，则仅计算直接信任</li>
<li>否则，对象的信任评估需要来自公共邻居节点的建议。</li>
</ol>
<h3><span id="直接计算信任"> 直接计算信任</span></h3>
<p>直接信任是通过考虑节点诚实和节点能力来计算的。</p>
<ol>
<li>基于直接通信行为计算节点诚实度以检查传感器节点是否可靠</li>
<li>用剩余能量度量传感器节点是否有能力执行其预期功能</li>
</ol>
<h4><span id="节点诚实度nh"> 节点诚实度（NH）</span></h4>
<p>使用主观逻辑模型。主观模型中的信任值被表示为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><mo>=</mo><mo>{</mo><mi>b</mi><mo separator="true">,</mo><mi>d</mi><mo separator="true">,</mo><mi>u</mi><mo>}</mo></mrow><annotation encoding="application/x-tex">T = \{b,d,u\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mrel">=</span><span class="mopen">{</span><span class="mord mathit">b</span><span class="mpunct">,</span><span class="mord mathit">d</span><span class="mpunct">,</span><span class="mord mathit">u</span><span class="mclose">}</span></span></span></span>, 其中，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi><mo separator="true">,</mo><mi>d</mi><mo separator="true">,</mo><mi>u</mi></mrow><annotation encoding="application/x-tex">b,d,u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit">b</span><span class="mpunct">,</span><span class="mord mathit">d</span><span class="mpunct">,</span><span class="mord mathit">u</span></span></span></span>分别对应信任，不信任和不确定并且<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi><mo separator="true">,</mo><mi>d</mi><mo separator="true">,</mo><mi>u</mi><mo>∈</mo><mo>[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo>]</mo><mo separator="true">,</mo><mi>b</mi><mo>+</mo><mi>d</mi><mo>+</mo><mn>1</mn><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">b,d,u\in [0,1], b+d+1=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit">b</span><span class="mpunct">,</span><span class="mord mathit">d</span><span class="mpunct">,</span><span class="mord mathit">u</span><span class="mrel">∈</span><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">1</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mord mathit">b</span><span class="mbin">+</span><span class="mord mathit">d</span><span class="mbin">+</span><span class="mord mathrm">1</span><span class="mrel">=</span><span class="mord mathrm">1</span></span></span></span>.基于此节点诚实度（NH）为：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi><mi>H</mi><mo>=</mo><mfrac><mrow><mn>2</mn><mi>b</mi><mo>+</mo><mi>u</mi></mrow><mrow><mn>2</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">  NH = \frac{2b+u}{2}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.37144em;"></span><span class="strut bottom" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="mrel">=</span><span class="mord reset-textstyle displaystyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathrm">2</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.677em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathrm">2</span><span class="mord mathit">b</span><span class="mbin">+</span><span class="mord mathit">u</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span></span></p>
<p>其中，b = \frac{s}{s+f+1}, u = \frac{1}{s+f+1}, s和f 是成功和不成功通信的数量。</p>
<p>如上所述，数据包丢失不仅是由恶意节点引起的，也是由不可靠的水下通信信道引起的。由不可靠的通信信道引起的丢包率（<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mrow><mi>P</mi><mi>L</mi><mi>R</mi></mrow></msub></mrow><annotation encoding="application/x-tex">P_{PLR}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">P</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.13889em;">P</span><span class="mord mathit">L</span><span class="mord mathit" style="margin-right:0.00773em;">R</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>）由ARIMA模型在5.1.1节中预测。因此，成功<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">s</span></span></span></span>和不成功<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span></span></span></span>的通信可以被更正为:</p>
  s_{new} = s+P_{plr} \times (s+f)\\
  f_{new} = f-P_{plr} \times (s+f)\tag{11}

<h4><span id="节点能力nc"> 节点能力（NC）</span></h4>
<p>假设所有传感器节点具有相同的初始能量水平和能量消耗率。但是，恶意节点总是消耗异常能量来发动恶意攻击。例如，启动DoS攻击的恶意节点比正常节点消耗更多能量，而自私节点消耗更少能量。因此，我们使用能量作为QoS信任度量来测量传感器节点是自私的还是恶意地耗尽额外的能量。</p>
<ol>
<li>
<p>首先，定义能量阈值 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span></span> 。当一个传感器节点的剩余能量<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>E</mi><mrow><mi>r</mi><mi>e</mi><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">E_{res}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.05764em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">s</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>下降到低于阈值时，传感器节点不足以胜任（没有足够的能量）来执行其预期的功能。因此，节点能力被认为是0</p>
</li>
<li>
<p>否则，节点能力基于能量消耗率<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>e</mi><mi>n</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{ene}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>计算，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>e</mi><mi>n</mi><mi>e</mi></mrow></msub><mo>∈</mo><mo>[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">p_{ene} \in [0,1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">∈</span><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">1</span><span class="mclose">]</span></span></span></span>。能量消耗率越高，剩余能量越少，这最终导致传感器节点完成任务的能力越小。因此，传感器节点的节点能力被认为更小。节点能力通过以下方式计算：</p>
NC = \left\{
\begin{aligned}
&1-p_{ene}, &E_{res}\geq \theta \\
&0, &E_{res} < \theta
\end{aligned}\tag{12}
\right.

<p>其中，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mrow><mi>e</mi><mi>n</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">p_{ene}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>是基于Ray Projection方法计算的。</p>
</li>
</ol>
<h4><span id="直接信任值计算"> 直接信任值计算</span></h4>
  T_{direct} = \left\{
  \begin{aligned}
  &0.5+(NH-0.5)\times NC, &NH\geq 0.5 \\
  &NH \times NC, &NH < 0.5
  \end{aligned}\tag{13}
  \right.

<h3><span id="间接计算信任"> 间接计算信任</span></h3>
<p>需要注意防止恶意节点的推荐。</p>
<ol>
<li>定义推荐可靠性<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>r</mi><mi>e</mi><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{rel}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>：计算推荐的平均值；获得推荐值和平均值之间的差异，差异越大，推荐的可靠性就越低。<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>r</mi><mi>e</mi><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{rel}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>计算如下：</li>
</ol>
  T_{rel} = 1-|T_{bc_i}-T_{ave}|\tag{14}

<p>​		其中，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>b</mi><msub><mi>c</mi><mi>i</mi></msub></mrow></msub></mrow><annotation encoding="application/x-tex">T_{bc_i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.93833em;vertical-align:-0.255em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15000000000000002em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">b</span><span class="mord"><span class="mord mathit">c</span><span class="vlist"><span style="top:0.15em;margin-right:0.07142857142857144em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>是推荐者<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">C_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.07153em;">C</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07153em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>报告的对象节点<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span></span>的推荐值，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>a</mi><mi>v</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{ave}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>是所有推荐的平均值。</p>
<ol start="2">
<li>
<p>如果推荐者的可靠性差（&lt;0.5），即使其推荐值非常高，也不能用于计算推荐信任。如果推荐者是可靠的（&gt; 0.5），则基于推荐值<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>b</mi><msub><mi>c</mi><mi>i</mi></msub></mrow></msub></mrow><annotation encoding="application/x-tex">T_{bc_i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.93833em;vertical-align:-0.255em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15000000000000002em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">b</span><span class="mord"><span class="mord mathit">c</span><span class="vlist"><span style="top:0.15em;margin-right:0.07142857142857144em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>的信任值和推荐<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>r</mi><mi>e</mi><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{rel}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>的可靠性，推荐信任计算如下</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>r</mi><mi>e</mi><mi>c</mi><mi>o</mi><mi>m</mi></mrow></msub><mo>=</mo><mfrac><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>n</mi></msubsup><msub><mi>T</mi><mrow><mi>r</mi><mi>e</mi><mi>l</mi></mrow></msub><mo>×</mo><msub><mi>T</mi><mrow><mi>b</mi><msub><mi>c</mi><mi>i</mi></msub></mrow></msub></mrow><mrow><mi>n</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">T_{recom} = \frac{\sum_{i=0}^n T_{rel} \times T_{bc_i}}{n}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.44001em;"></span><span class="strut bottom" style="height:2.12601em;vertical-align:-0.686em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">m</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord reset-textstyle displaystyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.686em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathit">n</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.69001em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped"><span class="mord textstyle uncramped"><span class="mop"><span class="op-symbol small-op mop" style="top:-0.0000050000000000050004em;">∑</span><span class="vlist"><span style="top:0.30001em;margin-left:0em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mrel">=</span><span class="mord mathrm">0</span></span></span></span><span style="top:-0.364em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit">n</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">×</span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15000000000000002em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">b</span><span class="mord"><span class="mord mathit">c</span><span class="vlist"><span style="top:0.15em;margin-right:0.07142857142857144em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle cramped"><span class="mord mathit">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span></span></p>
<p>其中，n是所有推荐者的数目。</p>
</li>
<li>
<p>节点信任值计算为：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>n</mi><mi>o</mi><mi>d</mi><mi>e</mi></mrow></msub><mo>=</mo><mrow><mo fence="true">{</mo><mtable><mtr><mtd><mrow></mrow></mtd><mtd><mrow><mrow></mrow><msub><mi>T</mi><mrow><mi>d</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow></msub><mo separator="true">,</mo></mrow></mtd><mtd><mrow><msub><mi>s</mi><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow></msub><mo>≥</mo><mi>T</mi><msub><mi>h</mi><mrow><mi>n</mi><mi>u</mi><mi>m</mi></mrow></msub></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd><mtd><mrow><mrow></mrow><msub><mi>w</mi><mrow><mi>d</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow></msub><msub><mi>T</mi><mrow><mi>d</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow></msub><mo>+</mo><msub><mi>w</mi><mrow><mi>r</mi><mi>e</mi><mi>c</mi><mi>o</mi><mi>m</mi></mrow></msub><msub><mi>T</mi><mrow><mi>r</mi><mi>e</mi><mi>c</mi><mi>o</mi><mi>m</mi></mrow></msub><mo separator="true">,</mo></mrow></mtd><mtd><mrow><msub><mi>s</mi><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow></msub><mo>&lt;</mo><mi>T</mi><msub><mi>h</mi><mrow><mi>n</mi><mi>u</mi><mi>m</mi></mrow></msub></mrow></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">T_{node} = \left\{
\begin{aligned}
&amp;T_{direct}, &amp;s_{new} \geq Th_{num}\\
&amp;w_{direct}T_{direct} + w_{recom}T_{recom}, &amp;s_{new}&lt;Th_{num}
\end{aligned}
\right.
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.45em;"></span><span class="strut bottom" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span><span class="mord mathit">o</span><span class="mord mathit">d</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size3">{</span></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="col-align-l"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"></span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">d</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">c</span><span class="mord mathit">t</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"></span><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">d</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">c</span><span class="mord mathit">t</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">d</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">c</span><span class="mord mathit">t</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">m</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">m</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="arraycolsep" style="width:2em;"></span><span class="col-align-r"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit">s</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02691em;">w</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">≥</span><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mord"><span class="mord mathit">h</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span><span class="mord mathit">u</span><span class="mord mathit">m</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit">s</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02691em;">w</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">&lt;</span><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mord"><span class="mord mathit">h</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span><span class="mord mathit">u</span><span class="mord mathit">m</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span></span></p>
<p>其中，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>d</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>r</mi><mi>e</mi><mi>c</mi><mi>o</mi><mi>m</mi></mrow></msub></mrow><annotation encoding="application/x-tex">w_{direct}, w_{recom}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">d</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">c</span><span class="mord mathit">t</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">m</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>分别是权重，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mrow><mi>d</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow></msub><mo>∈</mo><mo>[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo>]</mo><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>r</mi><mi>e</mi><mi>c</mi><mi>o</mi><mi>m</mi></mrow></msub><mo>∈</mo><mo>[</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo>]</mo><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>d</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>t</mi></mrow></msub><mo>+</mo><msub><mi>w</mi><mrow><mi>r</mi><mi>e</mi><mi>c</mi><mi>o</mi><mi>m</mi></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">w_{direct}\in[0,1], w_{recom}\in[0,1], w_{direct}+w_{recom}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">d</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">c</span><span class="mord mathit">t</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">∈</span><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">1</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">m</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">∈</span><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">1</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">d</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">c</span><span class="mord mathit">t</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">+</span><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">e</span><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">m</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">=</span><span class="mord mathrm">1</span></span></span></span></p>
</li>
</ol>
<h1><span id="信任值更新"> 信任值更新</span></h1>
<p>为了更新ARTMM中的信任，我们使用滑动时间窗口概念。计算链路，数据和节点的当前信任值。根据历史值更新信任值。为历史信任值定义时间衰减函数（越古老的信息占用越少的权重）。我们采用ARTMM中的指数衰减，其定义为：</p>
  w_{decay} = exp(-\delta \times (t-t_0))\tag{17}

<p>其中<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>δ</mi></mrow><annotation encoding="application/x-tex">\delta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03785em;">δ</span></span></span></span>是调节因子，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>δ</mi><mo>∈</mo><mo>(</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo>)</mo><mo separator="true">,</mo><mi>t</mi></mrow><annotation encoding="application/x-tex">\delta \in (0,1) , t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03785em;">δ</span><span class="mrel">∈</span><span class="mopen">(</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">1</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mord mathit">t</span></span></span></span>为当前信任值的时间，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">t_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">t</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>为历史信任值的时间。</p>
<h2><span id="内部依赖属性计算"> 内部依赖属性计算</span></h2>
<p>定义中间信任值<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>−</mo><mi>l</mi></mrow></msub><mo separator="true">,</mo><msub><mi>T</mi><mrow><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>−</mo><mi>d</mi></mrow></msub><mo separator="true">,</mo><msub><mi>T</mi><mrow><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>−</mo><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{inter-l}, T_{inter-d}, T_{inter-n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mbin">−</span><span class="mord mathit">d</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mbin">−</span><span class="mord mathit">n</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span> 用于更新链路交流，传输数据和参与节点的信任值。</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>−</mo><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{inter-l}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>根据传感器节点<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>n</mi><mi>o</mi><mi>d</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{node}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span><span class="mord mathit">o</span><span class="mord mathit">d</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>和传输数据<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{data}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">d</span><span class="mord mathit">a</span><span class="mord mathit">t</span><span class="mord mathit">a</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>的信任值确定。</li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>−</mo><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{inter-d}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mbin">−</span><span class="mord mathit">d</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>根据传感器节点<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>n</mi><mi>o</mi><mi>d</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{node}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span><span class="mord mathit">o</span><span class="mord mathit">d</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>和通信链路<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>l</mi><mi>i</mi><mi>n</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{link}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>的信任值确定。</li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>−</mo><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{inter-n }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mbin">−</span><span class="mord mathit">n</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>根据传输数据<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{data}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">d</span><span class="mord mathit">a</span><span class="mord mathit">t</span><span class="mord mathit">a</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>和通信链路<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>l</mi><mi>i</mi><mi>n</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{link}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>的信任值确定。</li>
</ul>
<p>这里，采用模糊逻辑方法计算链路，数据和节点的相互依赖性。</p>
<blockquote>
<!--模糊逻辑允许逻辑值在0，1之间-->
<p>假设模糊 成员函数信任值由五个模糊集组成：</p>
<ol>
<li>完全不信任，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mi>r</mi><mi>u</mi><mi>s</mi><mi>t</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>∈</mo><mo>[</mo><mn>0</mn><mo separator="true">,</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>2</mn><mn>5</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">trustvalue \in [0, 0.25)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">u</span><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">u</span><span class="mord mathit">e</span><span class="mrel">∈</span><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mpunct">,</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">2</span><span class="mord mathrm">5</span><span class="mclose">)</span></span></span></span></li>
<li>不信任，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mi>r</mi><mi>u</mi><mi>s</mi><mi>t</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>∈</mo><mo>[</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>2</mn><mn>5</mn><mo separator="true">,</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>5</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">trustvalue \in [0.25, 0.5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">u</span><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">u</span><span class="mord mathit">e</span><span class="mrel">∈</span><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">2</span><span class="mord mathrm">5</span><span class="mpunct">,</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">5</span><span class="mclose">)</span></span></span></span></li>
<li>不确定，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mi>r</mi><mi>u</mi><mi>s</mi><mi>t</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>=</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>5</mn></mrow><annotation encoding="application/x-tex">trustvalue = 0.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">u</span><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">u</span><span class="mord mathit">e</span><span class="mrel">=</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">5</span></span></span></span></li>
<li>信任，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mi>r</mi><mi>u</mi><mi>s</mi><mi>t</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>∈</mo><mo>[</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>5</mn><mo separator="true">,</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>7</mn><mn>5</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">trustvalue \in [0.5 , 0.75)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">u</span><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">u</span><span class="mord mathit">e</span><span class="mrel">∈</span><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">5</span><span class="mpunct">,</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">7</span><span class="mord mathrm">5</span><span class="mclose">)</span></span></span></span></li>
<li>完全信任，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi><mi>r</mi><mi>u</mi><mi>s</mi><mi>t</mi><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>∈</mo><mo>[</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>7</mn><mn>5</mn><mo separator="true">,</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">trustvalue \in [0.75, 1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">u</span><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">u</span><span class="mord mathit">e</span><span class="mrel">∈</span><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">7</span><span class="mord mathrm">5</span><span class="mpunct">,</span><span class="mord mathrm">1</span><span class="mclose">)</span></span></span></span></li>
</ol>
<p>信任等级的逻辑规则如下图所示</p>
<p><img src="./ARTMM%E5%BB%BA%E6%A8%A1%E7%AC%94%E8%AE%B0/%E4%BF%A1%E4%BB%BB%E5%80%BC%E9%80%BB%E8%BE%91%E8%A7%84%E5%88%99.png" alt></p>
<img src="/2019/07/20/ARTMM%E5%BB%BA%E6%A8%A1%E7%AC%94%E8%AE%B0/%E4%BF%A1%E4%BB%BB%E5%80%BC%E9%80%BB%E8%BE%91%E8%A7%84%E5%88%99.png" class>
<p>以<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>−</mo><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{inter-d}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mbin">−</span><span class="mord mathit">d</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>为例，上图的规则建立了一个从<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>n</mi><mi>o</mi><mi>d</mi><mi>e</mi></mrow></msub><mo>∘</mo><msub><mi>T</mi><mrow><mi>l</mi><mi>i</mi><mi>n</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{node} \circ T_{link}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span><span class="mord mathit">o</span><span class="mord mathit">d</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mbin">∘</span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>到<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>−</mo><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{inter-d}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mbin">−</span><span class="mord mathit">d</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>的映射。</p>
<p>对于每对给定的<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>n</mi><mi>o</mi><mi>d</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{node}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span><span class="mord mathit">o</span><span class="mord mathit">d</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>和<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>l</mi><mi>i</mi><mi>n</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{link}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>，使用一般总关系R，我们可以得到：</p>
T_{inter-d} = (T_{node}) \times T_{link} \circ R \tag{18}

<p>在<code>the maximum membership degree approach</code>的帮助下，我们根据去模糊化可得到确定的信任值<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>−</mo><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{inter-d}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mbin">−</span><span class="mord mathit">d</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>. 同理， 模糊逻辑方法还可以计算出<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>−</mo><mi>l</mi></mrow></msub><mo separator="true">,</mo><msub><mi>T</mi><mrow><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>−</mo><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{inter-l}, T_{inter-n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mbin">−</span><span class="mord mathit">n</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></p>
<h2><span id="链路信任值更新"> 链路信任值更新</span></h2>
<p>根据（17），我们可以更新第<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.65952em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">i</span></span></span></span>个时间窗口的链路信任值为：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>l</mi><mi>i</mi><mi>n</mi><mi>k</mi></mrow></msub><mo>(</mo><mi>i</mi><mo>)</mo><mo>=</mo><msub><mi>w</mi><mrow><mi>d</mi><mi>e</mi><mi>c</mi><mi>a</mi><mi>y</mi></mrow></msub><msub><mi>T</mi><mrow><mi>l</mi><mi>i</mi><mi>n</mi><mi>k</mi></mrow></msub><mo>(</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo>)</mo><mo>+</mo><mo>(</mo><mn>1</mn><mo>−</mo><msub><mi>w</mi><mrow><mi>d</mi><mi>e</mi><mi>c</mi><mi>a</mi><mi>y</mi></mrow></msub><mo>)</mo><msub><mi>T</mi><mrow><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>−</mo><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{link}(i) = w_{decay}T_{link}(i-1)+(1-w_{decay})T_{inter-l}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">i</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">d</span><span class="mord mathit">e</span><span class="mord mathit">c</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">i</span><span class="mbin">−</span><span class="mord mathrm">1</span><span class="mclose">)</span><span class="mbin">+</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">d</span><span class="mord mathit">e</span><span class="mord mathit">c</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></p>
<p>其中<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>l</mi><mi>i</mi><mi>n</mi><mi>k</mi></mrow></msub><mo>(</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">T_{link}(i-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">i</span><span class="mbin">−</span><span class="mord mathrm">1</span><span class="mclose">)</span></span></span></span>是第<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="base textstyle uncramped"><span class="mord mathit">i</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span>个时间窗口的链路信任值</p>
<h2><span id="数据信任值更新"> 数据信任值更新</span></h2>
<p>基于当前数据信任，中间数据信任和信任衰减函数，第i个时间窗口中的数据信任更新为：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi></mrow></msub><mo>(</mo><mi>i</mi><mo>)</mo><mo>=</mo><msub><mi>w</mi><mrow><mi>d</mi><mi>e</mi><mi>c</mi><mi>a</mi><mi>y</mi></mrow></msub><msub><mi>T</mi><mrow><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi></mrow></msub><mo>(</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo>)</mo><mo>+</mo><mo>(</mo><mn>1</mn><mo>−</mo><mi>d</mi><mi>e</mi><mi>c</mi><mi>a</mi><mi>y</mi><mo>)</mo><msub><mi>T</mi><mrow><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mo>−</mo><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{data}(i) = w_{decay}T_{data}(i-1)+(1-decay)T_{inter-d}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">d</span><span class="mord mathit">a</span><span class="mord mathit">t</span><span class="mord mathit">a</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">i</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">d</span><span class="mord mathit">e</span><span class="mord mathit">c</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">d</span><span class="mord mathit">a</span><span class="mord mathit">t</span><span class="mord mathit">a</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">i</span><span class="mbin">−</span><span class="mord mathrm">1</span><span class="mclose">)</span><span class="mbin">+</span><span class="mopen">(</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mord mathit">d</span><span class="mord mathit">e</span><span class="mord mathit">c</span><span class="mord mathit">a</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mbin">−</span><span class="mord mathit">d</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span></p>
<h2><span id="节点信任值更新"> 节点信任值更新</span></h2>
<p>在UASN中，传感器节点总是随着海流而移动。有两种情况需要考虑：</p>
<p><img src="./ARTMM%E5%BB%BA%E6%A8%A1%E7%AC%94%E8%AE%B0/%E6%B4%8B%E6%B5%81%E8%8A%82%E7%82%B9%E7%A7%BB%E5%8A%A8.png" alt></p>
<img src="/2019/07/20/ARTMM%E5%BB%BA%E6%A8%A1%E7%AC%94%E8%AE%B0/%E6%B4%8B%E6%B5%81%E8%8A%82%E7%82%B9%E7%A7%BB%E5%8A%A8.png" class>
</blockquote>
<ol>
<li>对于节点C，节点B是新的邻居节点，如何计算新邻居节点的信任值是第一个问题</li>
<li>当节点B在某个时间回退时，如何用历史信任值重新计算节点B的信任值</li>
</ol>
<h3><span id="新节点的信任迁移"> 新节点的信任迁移</span></h3>
<ol>
<li>如图4所示，节点B和节点C没有历史通信行为，因此，节点A计算出的B的信任值不能直接用于节点C</li>
<li>如果节点A信任节点B并且节点B信任节点C，可推断出A一定程度上信任节点C。因此，如果节点C认为节点A是值得信任的，则A计算出的节点B的信任值可迁移到C节点。否则，节点B的信任值设置为0.5。</li>
</ol>
<h3><span id="旧节点的信任迁移"> 旧节点的信任迁移</span></h3>
<p>对于返回的旧邻居节点，应在信任重新评估过程中考虑历史信任值。通常，传感器节点的信任值总是随着时间的推移而衰减。</p>
<p>当邻居节点在静态网络中连续地相互通信时，两个节点之间的信任值随时间成比例地衰减。</p>
<p>但是，当传感器节点移出其相邻节点的通信范围时，公式（17）中定义的衰减函数不再适用。</p>
<p>在这里，我们介绍了关系成熟度的概念，它基于两个节点之间关系的年龄。关系成熟度定义为：</p>
  RM = \frac{n_{ab}}{n_a} \times \beta^{\frac{1}{n_{ab}}}\tag{19}

<p>其中<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mrow><mi>a</mi><mi>b</mi></mrow></msub></mrow><annotation encoding="application/x-tex">n_{ab}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">n</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">a</span><span class="mord mathit">b</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>是A和B之间成功通信的次数，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">n_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">n</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">a</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span>是A节点总的成功通信的次数。时间衰减函数计算为：</p>
  w_{decay} = exp(-\delta \times (t-t_0) \times (1-RM))\tag{20}

<p>第<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.65952em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">i</span></span></span></span>个窗口的节点信任值更新为：</p>
  T_{node}(i)= w_{decay}T_{node}(i-1)+(1-w_{decay})T_{inter-n}\tag{21}

<p>其中<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>T</mi><mrow><mi>n</mi><mi>o</mi><mi>d</mi><mi>e</mi></mrow></msub><mo>(</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">T_{node}(i-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.13889em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">n</span><span class="mord mathit">o</span><span class="mord mathit">d</span><span class="mord mathit">e</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mopen">(</span><span class="mord mathit">i</span><span class="mbin">−</span><span class="mord mathrm">1</span><span class="mclose">)</span></span></span></span>是第<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.65952em;"></span><span class="strut bottom" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="base textstyle uncramped"><span class="mord mathit">i</span><span class="mbin">−</span><span class="mord mathrm">1</span></span></span></span>个时间窗口的节点信任值</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/26/Secure-Query-Processing-in-a-Cloud-Database-Environment/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Wenjie Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aven's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/26/Secure-Query-Processing-in-a-Cloud-Database-Environment/" class="post-title-link" itemprop="url">Secure Query Processing in a Cloud Database Environment</a>
        </h1>

        <div class="post-meta">

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1><span id="安全查询处理模型sdb的解读"> 安全查询处理模型SDB的解读</span></h1>
<h2><span id="方案来源"> 方案来源</span></h2>
<p>针对应用了DBaaS模型的云数据服务存在如下安全问题：Data Owner将数据服务外包给Service Provider, 数据在此时并不安全，Service Provider随时有可能将数据泄露出去。</p>
<p>为了保护隐私数据，有如下几种思路对数据进行加密：</p>
<ol>
<li>完全同态加密。缺点是显而易见的，计算开销过大。</li>
<li>部分同态加密。节约的开销，但由于计算类型受限，对数据的加密能力有限。</li>
<li>基于Secret Share提出的安全多计算模型，只要是闭合的运算都能被该模型所处理。</li>
<li>ShareMinds方案。主要思想为将shares分到独立的SP，基于SMC提供安全存储，并提供不同的计算协议。</li>
<li>本文将着重介绍的SDB方案。</li>
</ol>
<blockquote>
<p>秘密共享方案: 一种基于秘密共享方案是安全多方计算(SMC)，任何明文都可以分解成多 个份额，每个份额被多方中的一方持有，任何一方不可能以自己持有的份 额恢复出明文;多方通过定义执行协议来计算特定的函数，可以被证明的 是，只要是封闭的计算都能在SMC中实现。将SMC应用于云数据库环境，只 需要将敏感数据分解成多个份额，每个份额由一个独立的SP保存。例如， ShareMind就采用了这样的做法。ShareMind基于SMC提供安全存储以及一 系列针对不同操作的协议。但是ShareMind仍有一些缺陷:需要至少三个 独立的SP，计算开销大(SP上的计算和SP之间的通信)。</p>
</blockquote>
<p>SDB方案是一种在云数据库环境下具备数据协同处理能力的安全查询模型，以下是相关概念：</p>
<ol>
<li>云数据库环境</li>
</ol>
<p>本文的云数据库环境指的是 Database-as-a-service-model,是一种数据 持有者(DO)和计算服务提供者(SP)分离的一种环境，这种模式(DBaaS) 的优点是负载均衡，理想状态下，对于应用提出的查询请求，DO 仅仅需要 提供数据，查询操作能够分担给一个或多个 SP，极大提高了云数据库的计 算效率。但缺点也是显而易见的，DO 在将计算外包给 SP 的同时，如果不 对传给 SP 的数据进行加密处理，数据会泄露给 SP。</p>
<ol start="2">
<li>
<p>安全查询处理<br>
为避免敏感数据从 DO 泄露给 SP，需要提出一种方案在不泄露敏感数据的 同时能够发挥云数据库的负载均衡的能力。</p>
</li>
<li>
<p>数据协同处理能力 现有方案尽管能够实现安全查询处理，但是当遇到复杂的查询语句时(一 个语句中包含多种操作符)，无法执行，因为这些方案都是对不同的操作符 设计了不同的加密函数，这使得数据的协同处理成为短板。本文提出的方 案能够有效克服这个缺点，这也是本方案的一大创新点。</p>
</li>
</ol>
<h2><span id="模型"> 模型</span></h2>
<p>SDB 模型也是基于秘密共享，并且只需要一个 SP 和一个 DO 就可执行支持大部分 基本 SQL 查询语句的协议。</p>
<h3><span id="数据说明"> 数据说明</span></h3>
<p>使用[v]表示敏感数据v，符号[]表示当中的数据应该为密文且被安全保存。 [v]使用秘密共享生成两个份额，分别为:𝒗𝒌(保存在 DO)以及𝒗𝒆(保存 在 SP)。本文的目标是防止通过𝒗𝒆恢复出对应的[v]集合。另外，数据库由 一系列表构成，因为本文的方案建立在关系模型上。表中每列为全明文或 者全密文。</p>
<h3><span id="模型架构"> 模型架构</span></h3>
<p><img src="./Secure-Query-Processing-in-a-Cloud-Database-Environment/architecture.png" alt></p>
<img src="/2019/04/26/Secure-Query-Processing-in-a-Cloud-Database-Environment/architecture.png" class>
<ol>
<li>SP 使用 DBMS 存储非敏感数据的明文或者敏感数据的𝒗𝒆。</li>
<li>敏感数据的𝒗𝒌由 DO 保存，但 DO 不需要实际存储所有𝒗𝒌,而是存储每个敏感列的 column key(ck),敏感列 A 所有𝒗𝒌可以由𝒄𝒌𝐀生成。</li>
<li>SDB 由软件层实现，分别是客户层和服务层。</li>
<li>客户层接收从应用发来的查询，并将其翻译成为一个查询计划。</li>
<li>查询计划生成一系列对数据的操作，如果操作仅仅设计非敏感数据，操作直接传递给 SP;否则，操作被秘密共享协议执行。</li>
<li>秘密共享协议包括一个轻量级的客户端协议和一个服务器协议。客户端协议准备一条包括数据 id、执行的操作以及一个线索组成的消息。线 索由相关的 ck 生成并用于 SP 正确执行密文的计算。消息通过秘密信道发送给 SP。</li>
<li>当服务层收到消息时，它根据 id 标识相关数据。如果这个数据存在于内存里，例如这个数据是上一步操作的结果，服务层运行服务协议来对 驻留在缓存的数据执行操作;否则，从 DBMS 中取出数据再运行服务协议。</li>
<li>最后一步计算结果返回给客户层，解密之后即为对应的明文结果。</li>
</ol>
<h3><span id="查询操作"> 查询操作</span></h3>
<p>支持的查询如下所示：</p>
<p><img src="./Secure-Query-Processing-in-a-Cloud-Database-Environment/query.png" alt></p>
<img src="/2019/04/26/Secure-Query-Processing-in-a-Cloud-Database-Environment/query.png" class>
<h4><span id="说明"> 说明</span></h4>
<ul>
<li>协议:对于客户协议，将ck作为输入和输出;对服务协议，将密文列作为 输入和输出。</li>
<li>操作模式:EE模式表示两个操作数都是密文;EC模式表示一个操作数是密 文，另一个是常数;EP 模式表示一个操作数分别是密文和明文，后续对于 不同操作的讨论仅限 EE 模式和 EC 模式，因为 EP 模式可以转换成为 EC 模 式。</li>
<li>操作输出:很多情况下，一个操作输出的结果是查询的中间结果，因此它 仅仅短暂存在，并不会存储到数据库中。为了简化讨论结果，本文省略中 间数据实际存储的细节。</li>
<li>附加列:附加列添加的目的是为了实现多种安全操作，对于每个表 T，添 加两列 S 和 R，S 的每一行为 1，R 的每一行为随机数，S 列和 R 列使用上 文的秘密共享进行加密，并将对于的 ck 存储于 DO，𝑺𝒆和𝐑𝒆保存在 SP。</li>
<li>由于𝒗𝒌的计算公式，若𝒄𝐤𝑨 =&lt;𝒎,𝟎&gt;,则A列的所有值都有相同的𝒗𝒌 =m; 若𝒄𝐤𝑨 = &lt; 𝟏, 𝟎 &gt;，则所有的𝒗𝒆 = [𝒗]，这种性质可以在计算中需要明文结 果的时候使用到，例如选择语句中的比较操作，但是本文证明了这种方式 并不会真正泄露明文。</li>
</ul>
<h4><span id="乘操作"> 乘操作:</span></h4>
<h5><span id="ee模式"> EE模式:</span></h5>
<p>设操作的两列分别为A和B，𝒄𝐤𝑨 =&lt;𝐦𝑨,𝒙𝑨 &gt;,𝒄𝐤𝑩 =&lt;𝐦𝑩,𝒙𝑩 &gt;,C=A ×B 为输出列,设𝒄𝐤𝐂 = &lt; 𝐦𝑪, 𝒙𝑪 &gt; =&lt; 𝐦𝑨𝐦𝑩, 𝒙𝑨 + 𝒙𝑩 &gt;,则客户协议计 算𝐜𝒌 = 𝐦𝑪 · 𝒈𝒓𝒙𝑪 = 𝐦𝑨𝐦𝑩 · 𝒈𝒓(𝒙𝑨]𝒙𝐁) = 𝐚𝐤𝐛𝐤(𝒎𝒐𝒅𝒏),根据𝐜𝒌和𝐜𝒆恢复明 文:𝐜 = 𝐜𝒆𝐜𝒌 = 𝐚𝐞𝐛𝐞𝐜𝐤 = 𝒂 𝒂V𝒌𝟏 𝒃 𝒃V𝒌𝟏𝒂𝒌𝒃𝒌 = 𝒂 [𝒃],因此设置𝒄𝐤𝐂 = &lt; 𝐦𝑪, 𝒙𝑪 &gt; =&lt; 𝐦𝑨𝐦𝑩, 𝒙𝑨 + 𝒙𝑩 &gt;能够使得协议计算正确。</p>
<h5><span id="ec模式"> EC模式</span></h5>
<p>设操作的两列分别为A和p，𝒄𝐤𝑨 =&lt;𝐦𝑨,𝒙𝑨 &gt;,p为常数,C=A ×p 为输出列，设𝒄𝐤𝐂 = &lt; 𝐦𝑪, 𝒙𝑪 &gt; =&lt; 𝐩 · 𝐦𝑨, 𝒙𝑨 &gt;，服务协议设表中的 每列的𝒄𝒆=𝒂𝒆,通过引用实现。客户协议计算𝐜 =𝒄𝒆·𝒄𝒌=𝒂𝒆·𝒄𝒌=𝒂𝒂V𝒌𝟏𝒄𝒌= 𝒂𝒂V𝒌𝟏·𝒑·𝒂𝒌=𝒑[𝒂].</p>
<h5><span id="秘钥更新"> 秘钥更新</span></h5>
<p>秘钥更新表示为𝛋(𝐀,&lt; 𝒎𝑪,𝒙𝑪 &gt;),操作符为列A和更新后的秘钥的𝐜𝐤𝑪，其中A 和 C 的明文值相同。利用 S 列秘钥𝒄𝐤𝒔 = &lt; 𝒎𝒔, 𝒙𝒔 &gt;,客户协议计算 p, q:<br>
𝐩 = 𝒙 V𝒔 𝟏 𝒙 𝒄 − 𝒙 𝑨 𝒎 𝒐 𝒅 𝝋 𝒏 , 𝐪 = 𝒎 𝑨 𝒎 𝒑𝒔 𝒎 V𝒄 𝟏 𝒎 𝒐 𝒅 𝒏 𝒑 然后将p和q发送给服务层，服务协议计算出列C的加密值:𝒄𝒆 = 𝒒 · 𝒂𝒆 · 𝒔𝒆. 由于:</p>
<p>由于p和q由A和C的列秘钥生成，因此我们应该保证攻击者知道p和q之后 不能推断出任何秘钥的信息。以下性质被[1]证明:<br>
1 攻击者拥有DB知识，得到p，q和𝒄𝐤𝒄的情况下不能恢复𝒄𝐤𝑨或𝒄𝐤𝐬.<br>
2 攻击者拥有DB知识，得到p，q和𝒄𝐤𝑨的情况下不能恢复𝒄𝐤𝑪或𝒄𝐤𝐬.</p>
<h4><span id="加减操作"> 加减操作</span></h4>
<p>下面详述加操作，减操作十分类似。</p>
<h5><span id="ee模式"> EE模式:</span></h5>
<p>设操作的两列分别为A和B，𝒄𝐤𝑨 =&lt;𝐦𝑨,𝒙𝑨 &gt;,𝒄𝐤𝑩 =&lt;𝐦𝑩,𝒙𝑩 &gt;,C=A+B 为输出列。我们注意到如果A，B，C的值 𝐚,𝐛,𝐜的秘钥均为k，则有:</p>
<p>故可利用秘钥协议辅助计算:客户协议首先生成𝒄𝐤𝒄 =&lt;𝒎𝒄,𝒙𝒄 &gt;,然后执 行秘钥更新协议，计算出𝑨k = 𝜿(𝑨, &lt; 𝒎𝒄, 𝒙𝒄 &gt;), 𝑩k = 𝜿(𝑩, &lt; 𝒎𝒄, 𝒙𝒄 &gt;), 并将秘钥更新中的 p 和 q 传给服务层，服务层通过计算𝐜𝒆 = 𝒂k𝒆 + 𝒃k𝒆就能 得出 C 列对应的加密加结果。</p>
<h5><span id="ec模式"> EC模式:</span></h5>
<p>设两个操作数分别为列 A 和常数 u，可通过计算 A +(S×u)得到结果。S 为附加列中全 1 的列，这样可将操作拆分为 EC 乘和 EE 加。</p>
<h4><span id="比较操作"> 比较操作</span></h4>
<p>考虑两个比较操作=和&gt;，给出两列 A 和 B，比较结果用列 C 保存，C 中值为 1 表示比较结果为真，0 表示比较结果为假，由于在选择语句中服务层需要知道 比较结果才能进行选择，因此 C 列以明文保存。为计算 C，协议首先计算 Z = R ×(A-B), R 是附加列中的随机列。接着对 Z 进行秘钥更新，计算𝒁k = 𝜿(𝒁, &lt; 𝟏, 𝟎 &gt;),由本章 1)节说明5可以知道𝒁k的加密值和明文结果一致，因此服务端 能知道 R×(A-B)的结果，因为 R 为随机列，因此在不会泄露 A 和 B 的信息的情 况下服务端就能计算出比较结果，EP 模式下也如此。</p>
<h4><span id="投影操作"> 投影操作</span></h4>
<p>投影操作并不会对表中数据产生实际操作，而是通过服务协议返回需要的列， 客户协议对返回结果进行解密即可。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/04/iOS-Memory-Management/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Wenjie Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aven's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/02/04/iOS-Memory-Management/" class="post-title-link" itemprop="url">iOS Memory Management</a>
        </h1>

        <div class="post-meta">

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1><span id="oc中的内存管理"> OC中的内存管理</span></h1>
<h2><span id="引用计数"> 引用计数</span></h2>
<h3><span id="理解和使用引用计数"> 理解和使用引用计数</span></h3>
<p>说到OC中的内存管理，便要从引用计数这个概念作为切入点来理解。简单来说，引用计数即是一种在需要持有对象的时候进行计数增，释放的时候进行计数减的机制，理论上来说，计数为0的时候即是对象声明周期结束、应当被销毁的时候。因为无人引用的时候对象便不再被需要。但更客观的思考方式应该注意到应该由谁持有和应该由谁释放的问题，具体来说有以下几个原则：</p>
<ul>
<li>自己生成的对象，自己持有</li>
<li>非自己生成的对象，自己也能持有</li>
<li>不再需要自己持有对象时应当释放</li>
<li>非自己持有的对象无法释放</li>
</ul>
<p>分别对应的OC方法如下表所示：</p>
<table>
<thead>
<tr>
<th>对象操作</th>
<th>OC方法</th>
</tr>
</thead>
<tbody>
<tr>
<td>生成并持有对象</td>
<td>alloc/new/copy/mutableCopy</td>
</tr>
<tr>
<td>持有对象</td>
<td>retain</td>
</tr>
<tr>
<td>释放对象</td>
<td>release</td>
</tr>
<tr>
<td>销毁对象</td>
<td>dealloc</td>
</tr>
</tbody>
</table>
<p>举个例子：</p>
<pre class="highlight"><code class="objective-c">/**自己生成并持有对象**/
id obj = [[NSObject alloc] init];
/**自己持有对象**/
/**释放对象**/
[obj release];
/**对象已被释放，不可再被访问**/
</code></pre>
<p>另一种方式：</p>
<pre class="highlight"><code class="objective-c">/**生成对象但并不持有, 此时引用计数为0**/
id obj = [NSMutableArray array];
/**持有对象**/
[obj retain];
/**自己持有对象**/
/**释放对象**/
[obj release];
/**对象已被释放，不可再被访问**/
</code></pre>
<p>如果企图释放计数已经为0的对象或者是自己没有持有的对象，将会造成程序崩溃。</p>
<h3><span id="autorelease"> Autorelease</span></h3>
<p>除了<code>retain</code>和<code>release</code> 之外，还有一种用于操作计数器的方法：<code>autorelease</code>. <code>autorelease</code>将引用计数递减这一活动延后执行。</p>
<p><code>autorelease</code>的使用方法如下：</p>
<ul>
<li>生成并持有<code>NSAutoreleasePool</code>对象</li>
<li>调用已分配对象的<code>autorelease</code>实例方法</li>
<li>废弃<code>NSAutoreleasePool</code>对象</li>
</ul>
<pre class="highlight"><code class="objective-c">/**生成并持有NSAutoreleasePool对象**/
NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];
id obj = [[NSObject alloc] init];
/**调用已分配对象的autorelease实例方法**/
[obj autorelease];
/**废弃NSAutoreleasePool对象**/
[pool drain];
</code></pre>
<p>但是在<code>Cocoa</code>框架中，在充当程序主循环的<code>NSRunloop</code>或其他可运行程序的地方都会对<code>NSAutoreleasePool</code>对象进行生成、持有、废弃处理，因此不必非要采用<code>NSAutoreleasePool</code>对象手动管理资源的生成、持有、释放。</p>
<p><img src="./iOS-Memory-Management/NSAutoreleasePoolCircle.jpeg" alt></p>
<img src="/2018/02/04/iOS-Memory-Management/NSAutoreleasePoolCircle.jpeg" class>
<p>但是，在这种模式下，当大量产生<code>autorelease</code>对象时，只要<code>NSAutoreleasePool</code>对象没有废弃，那么对象也不能被释放，因此会带来内存不足的问题，此时需要在适当的位置手动生成、持有、废弃<code>NSAutoreleasePool</code>对象。</p>
<p>例如，在读入图像文件，生成UIImage对象时：</p>
<pre class="highlight"><code class="objective-c">for(int i = 0; i &lt; imageCount; ++i) {
  NSAutoreleasePool * pool = [[NSAutoreleasePool alloc] init];
  
  /**读入图像文件, 产生需要autorelease的对象**/
  
  [pool drain];	//此时，对象及时被释放；
}
</code></pre>
<h2><span id="自动引用计数"> 自动引用计数</span></h2>
<h3><span id="arc特性简介"> ARC特性简介</span></h3>
<p>ARC仍然采用的是引用计数式内存管理的机制，只不过<code>retain</code>和<code>release</code>由ARC自动添加，因此，在ARC下这些内存管理方法是不可被开发者调用的：</p>
<ul>
<li><code>retain</code></li>
<li><code>release</code></li>
<li><code>autorelease</code></li>
<li><code>dealloc</code></li>
</ul>
<p>此外，ARC在调用这些方法时并不通过消息派发机制，而是直接调用底层C版本，能够节省很多CPU周期，提升性能。这也是这些方法在ARC下不可被覆写的一个原因。</p>
<p>ARC的另一个优化是，在编译期，能够把互相抵消的<code>retain</code>, <code>release</code>, <code>autorelease</code>化简。如果在一个对象上执行了多次保留与释放的操作，那么ARC可以成对移除这两个操作。这样的实现通过设置标志位来执行。</p>
<p>例如，ARC在运行期检测出当<code>autorelease</code>后紧跟<code>retain</code>时，不直接调用对象的<code>autorelease</code>方法，而是改为调用<code>objc_autoreleaseReturnValue</code>. 用标志位的方法来消除多余操作。</p>
<pre class="highlight"><code class="objective-c">/**objc_autoreleaseReturnValue 伪代码**/
id objc_autoreleaseReturnValue(id object) {
  if(/*调用者之后还会retain这个对象*/) {
    set_flag(object);	// 设置标志位
    return object;	// 直接返回
  } else {
    return [object autorelease];
  }
}
</code></pre>
<p>同理，若是执行<code>retain</code>后紧跟<code>autorelease</code>, 则改为调用<code>obj_retainAutoreleasedReturnValue</code></p>
<pre class="highlight"><code class="objective-c">/**obj_retainAutoreleasedReturnValue 伪代码**/
id obj_retainAutoreleasedReturnValue(id object) {
  if(get_flag(object)) {	// 检测到标志位被设置
    clear_flag(object);	// 清除标志位
    return object;	// 返回
  } else {
    return [object retain];
  }
}
</code></pre>
<p>设置和检测标志位，比直接调用<code>autorelease</code>和<code>retain</code>更快</p>
<h3><span id="arc下的内存管理语义"> ARC下的内存管理语义</span></h3>
<p>以设置方法为例，当我们使用ARC时只需这么写，ARC能够自动添加相关的<code>retain</code>和<code>release</code>操作</p>
<pre class="highlight"><code class="objective-c">- (void) setObject: (id) object {
  _object = object;
}
</code></pre>
<p>如果是MRC，需要我们手动添加<code>retain</code>和<code>release</code>的操作</p>
<pre class="highlight"><code class="objective-c">- (void) setObject: (id) object {
  [_object release];
  _object = [object retain];
}
</code></pre>
<p>但是这么写会出现问题。如果新值和旧值相同，并且当前只有该对象在引用这个值，那么设置方法中的<code>release</code>会让<code>_object</code>的引用计数为0，从而被回收，导致应用程序崩溃。而ARC避免这种情况的做法是，以一种更安全的方式来设置：</p>
<pre class="highlight"><code class="objective-c">- (void) setObject: (id) object {
  [object retain];	// 保留新值
  [_object release];	// 释放旧值
  _object = object;		// 设置
}
</code></pre>
<p>使用ARC避免了这种边界情况，而且使得代码的编写更加简洁。我们可以用所有权修饰符来控制ARC下对象的内存管理语义：</p>
<ul>
<li><code>__strong</code>: 默认语义，只要有一个被它修饰的指针指向某对象，这个对象就不能被回收。</li>
<li><code>__weak</code>: 并不能保证被修饰的指针指向的对象一定存活。当某对象没有被强引用时，其弱引用会被设置为nil</li>
<li><code>__unsafe_unretained</code>: 并不能保证被修饰的指针指向的对象一定存活。与<code>__weak</code>不同, 当某对象没有被强引用时，其弱引用也不会被设置为<code>nil</code>，如果它引用的对象被销毁，这个指针会成为悬挂指针</li>
<li><code>__autoreleasing</code>: 把对象按引用传递给方法时，使用这个特殊的修饰符，这个值在方法返回时自动释放。</li>
</ul>
<p>需要留意的是，修饰符修饰的引用也有其作用范围，超出范围之外即便是<code>__strong</code>修饰的也会失效，应该被释放。当带有<code>__strong</code> 修饰符的变量在持有对象时，如果多个对象相互持有，很容易发生循环引用，进而引发内存泄露。例如：</p>
<pre class="highlight"><code class="objective-c">NSURL *url = [NSURL URLWithString:@&quot;http://www.example.com&quot;];
MyNetworkFetcher * fetcher = [[MyNetworkFetcher alloc] initWithURL];
[fetcher startWithCompletion:^(BOOL success) {
  NSLog(@&quot;Successfully fetching from %@&quot;, fetcher.url);
}]
</code></pre>
<p>此段代码中，由于块能够自动保留捕获的全部对象，因此这个块保留了<code>fetcher</code>,而<code>fetcher</code>本身又引用了这个块，因此构成了保留环。解除保留环最常用的就是利用__weak修饰局部变量，这样，当强引用释放，弱引用也会被设置为nil，从而解除保留环。我们可以这么修复这段代码：</p>
<pre class="highlight"><code class="objective-c">NSURL *url = [NSURL URLWithString:@&quot;http://www.example.com&quot;];
MyNetworkFetcher * fetcher = [[MyNetworkFetcher alloc] initWithURL];
MyNetworkFetcher * __weak weakFetcher = fetcher;
[fetcher startWithCompletion:^(BOOL success) {
  NSLog(@&quot;Successfully fetching from %@&quot;, weakFetcher.url);
}]
</code></pre>
<p>ARC下无法直接调用<code>autorelease</code>方法，也无法使用<code>NSAutoreleasePool</code>类, 但是我们可以通过<code>@autoreleasepool</code>块来代替<code>NSAutoreleasePool</code>进行对象的生成、持有、废弃的作用域</p>
<pre class="highlight"><code class="objective-c">@autoreleasepool{
  id __autoreleasing object = [[NSObject alloc] init];
}
</code></pre>
<p>但是通常<code>__autoreleasing</code>并不显式调用，因为@autoreleasepool块指明了对象的作用域，若是最后需要在超出作用域的范围使用变量，则编译器会自动注册<code>autoreleasepool</code>对象来完成推迟release这一操作。</p>
<h3><span id="arc使用规则"> ARC使用规则</span></h3>
<p>最后，在ARC有效的情况下编译源代码需要遵守一定的规则：</p>
<ul>
<li>不能使用<code>retain/release/retainCount/autorelease</code></li>
<li>不能使用<code>NSAllocateObject/NSDeallocateObject</code></li>
<li>遵守内存管理的方法命名规则</li>
<li>不要显示调用<code>dealloc</code></li>
<li>使用<code>@autoreleasepool</code>块代替<code>NSAutoreleasePool</code></li>
<li>不要使用<code>NSZone</code></li>
<li>对象型变量不能作为C语言结构体的成员</li>
<li>显示转换<code>id</code>和<code>void</code></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/02/01/OC-Object-and-Message/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Wenjie Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aven's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2018/02/01/OC-Object-and-Message/" class="post-title-link" itemprop="url">OC Object and Message</a>
        </h1>

        <div class="post-meta">

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1><span id="oc-对象和消息"> OC 对象和消息</span></h1>
<p>在使用面向对象语言编程的时候，<strong>对象</strong>就是<strong>基本构造单元</strong>，通过对象可以存储并传递数据，<strong>消息传递</strong>就是在对象间传递数据并执行任务的过程。当应用程序运行起来以后，为其提供相关支持的代码叫做<strong>运行期环境</strong>(runtime)，用于提供一些使得对象之间能够传递传递消息的重要函数，此外，runtime还包含了创建类实例所用的全部逻辑。本文将简单分析对象和消息的一些机制。</p>
<h2><span id="属性"> 属性</span></h2>
<p>属性用于封装对象中的数据，OC中的对象通常将需要的数据保存为各种实例变量，通过存取方法访问。</p>
<p>在Java或者C++中的实例变量看上去也许是这样的：</p>
<pre class="highlight"><code class="c++"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> {</span>
  <span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">string</span> firstName;
    <span class="hljs-built_in">string</span> lastName;
	<span class="hljs-keyword">private</span>:
    <span class="hljs-built_in">string</span> IDNumber;
}
</code></pre>
<p>这样就能够定义实例变量的作用域。但是编写OC时很少这么做：</p>
<pre class="highlight"><code class="objective-c">@interface Person: NSObject {
  @public 
    NSString *_firstName;
  	NSString *_lastName;
  @private
    NSString *_IDNumber;
}
</code></pre>
<p>因为这种写法的对象布局在编译器就已经确定。换句话说，编译器将访问<code>_firstName</code>变量的代码替换为<strong>偏移量</strong>，用于表示变量距离存放对象内存的起始地址有多远，假如新增一个变量在<code>_firstName</code>前：</p>
<pre class="highlight"><code class="objective-c">@interface Person: NSObject {
  @public     
    NSString *_birthday;	// 新增变量
    NSString *_firstName;    
  	NSString *_lastName;  
  @private    
    NSString *_IDNumber;
}
</code></pre>
<p>内存布局变化将如下所示</p>
<p>新增实例变量前:</p>
<table>
<thead>
<tr>
<th>distance</th>
<th>Person</th>
</tr>
</thead>
<tbody>
<tr>
<td>+0</td>
<td><code>_firstName</code></td>
</tr>
<tr>
<td>+4</td>
<td><code>_lastName</code></td>
</tr>
<tr>
<td>+8</td>
<td><code>_IDNumber</code></td>
</tr>
</tbody>
</table>
<p>新增实例变量后:</p>
<table>
<thead>
<tr>
<th>distance</th>
<th>Person</th>
</tr>
</thead>
<tbody>
<tr>
<td>+0</td>
<td><code>_birthday</code></td>
</tr>
<tr>
<td>+4</td>
<td><code>_firstName</code></td>
</tr>
<tr>
<td>+8</td>
<td><code>_lastName</code></td>
</tr>
<tr>
<td>+12</td>
<td><code>_IDNumber</code></td>
</tr>
</tbody>
</table>
<p>这样的后果就是如果代码使用了编译期计算出来的偏移量，那么在修改类定义之后必须重新编译，否则会出错。OC的解决办法是：<strong>将实例变量当做一种存储偏移量所用的特殊变量，交给类对象保管，偏移量在运行期再查找</strong>，由此保证始终正确的偏移量。这提供了可以在class-continuation分类或者实现文件中定义实例变量的能力。</p>
<p>还有一种解决方案是通过存取方法访问变量，<strong>尽量不直接访问实例变量</strong>。这时属性便派上了用场，因为使用属性能够让编译器自动编写访问这些属性所需的方法。这个过程由编译器在编译期执行，所以在编辑器里这些合成方法的源代码不可见。此外，编译期还要自动向类中添加合适类型的实例变量，并且在属性名前加<code>_</code>，以此作为实例变量的名字。</p>
<blockquote>
<p>@synthesize 语法可以指定实例变量的名字，但一般情况下无需修改。</p>
<p>@dynamic语法用于阻止编译器自动创建实现属性所用的实例变量及其存取方法，此时，编译器认为这些属性的存取方法在运行期一定能找到。</p>
</blockquote>
<h2><span id="属性特质"> 属性特质</span></h2>
<p>属性特质(attribute)可分为：</p>
<ul>
<li>原子性</li>
<li>读写权限</li>
<li>内存管理语义</li>
<li>方法名</li>
</ul>
<h3><span id="原子性"> 原子性</span></h3>
<ul>
<li><code>atomic/nonatomic</code></li>
</ul>
<p>默认情况下，由编译器合成的方法会通过锁的机制确保其具有原子性(atomic)，但需要注意的是，即便是atomic也不能确保线程安全，反而占用了较大的开销。要实现线程安全，需要更深层的锁机制。</p>
<h3><span id="读写权限"> 读写权限</span></h3>
<ul>
<li><code>readwrite</code>：可读可写</li>
<li><code>readonly</code>：可读</li>
</ul>
<h3><span id="内存管理语义"> 内存管理语义</span></h3>
<ul>
<li><code>assign</code>: 设置方法只执行针对标量的简单赋值，如<code>CGFloat, NSInteger</code></li>
<li><code>strong</code>: 表示属性定义了一种拥有关系，设置方法先保留新值，再释放旧值，最后将新值设置</li>
<li><code>weak</code>: 表示属性定义了一种非拥有关系，设置时，既不保留新值，也不释放旧值，当属性所指对象被摧毁时，属性值也清空</li>
<li><code>unsafe_unretained</code>: 适用于对象类型，语义与<code>assign</code>相同，当对象摧毁时，属性值不会自动清空，不安全</li>
<li><code>copy</code>: 表示的所属关系与<code>strong</code>类似，但设置方法不保留新值，而是将其拷贝</li>
</ul>
<h3><span id="方法名"> 方法名</span></h3>
<ul>
<li><code>getter=&lt;name&gt;</code>: 指定获取方法名</li>
<li><code>setter=&lt;name&gt;</code>: 指定设置方法名，不常见</li>
</ul>
<blockquote>
<p>注意，绝不应该在init或者dealloc中调用存取方法，因为子类可能会覆写设置方法</p>
</blockquote>
<p>直接访问实例变量和通过属性访问有几个区别：</p>
<ul>
<li>直接访问实例变量不经过方法派发，因此访问速度快</li>
<li>直接访问实例变量时，不会调用其设置方法，也就绕过了为相关属性所定义的内存管理语义</li>
<li>直接访问实例变量不会触发键值观测</li>
<li>通过属性访问能够通过断点监测属性调用者和访问时机</li>
</ul>
<p>这也是为什么要在写入实例变量时使用设置方法来做，而读取则采取直接访问的原因。另外还需注意，在使用lazy initialization 时，必须通过获取方法来访问属性，否则实例变量永远不会被初始化。</p>
<h2><span id="关联对象"> 关联对象</span></h2>
<p>可以给某对象关联许多其他对象，并指明其存储策略来维护相应的内存管理语义。表示存储策略的枚举类型<code>obj_AssociationPolicy</code>取值及其对应语义如下所示：</p>
<table>
<thead>
<tr>
<th>关联类型</th>
<th>语义</th>
</tr>
</thead>
<tbody>
<tr>
<td>OBJC_ASSOCIATION_ASSIGN</td>
<td>assign</td>
</tr>
<tr>
<td>OBJC_ASSOCIATION_RETAIN_NONATOMIC</td>
<td>nonatomic, retain</td>
</tr>
<tr>
<td>OBJC_ASSOCIATION_COPY_NONATOMIC</td>
<td>nonatomic, copy</td>
</tr>
<tr>
<td>OBJC_ASSOCIATION_RETAIN</td>
<td>retain</td>
</tr>
<tr>
<td>OBJC_ASSOCIATION_COPY</td>
<td>copy</td>
</tr>
</tbody>
</table>
<p>关联对象管理方法：</p>
<pre class="highlight"><code class="objective-c">void objc_setAssociatedObject(id object, void*key, id value, obj_AssociationPolicy policy);	// 设置某对象的关联对象值，关联对象以key区分

id objc_getAssociatedObject(id object, void*key);	// 获取关联对象值

void objc_removeAssociatedObjects(id object);	// 移除指定对象的全部关联对象
</code></pre>
<p>需要注意，关联对象的使用可能引入一些难以查找的bug，例如保留环问题，需要谨慎使用。</p>
<h2><span id="消息传递"> 消息传递</span></h2>
<p>在对象上调用方法叫做<strong>消息传递</strong>。C语言的函数调用方式采用的是静态绑定，但是OC不同，需要采用动态绑定机制来确定需要调用哪一个方法。在底层，所有方法都是普通的C函数，然而在对象收到消息后，调用哪一个方法完全由运行期决定，甚至能在程序运行时改变。下面是给某对象发送消息的格式：</p>
<pre class="highlight"><code class="objective-c">id returnValue = [someObject messageName: parameter];
</code></pre>
<p>其中<code>someObject</code>是接收者，<code>messageName</code>和<code>parameter</code>同时构成<strong>消息</strong>。编译器看到这条消息后将它转换为一条标准的C函数调用：<code>objc_msgSend</code></p>
<pre class="highlight"><code class="objective-c">id returnValue = objc_msgSend(someObject, @selector(messageName:), parameter);
</code></pre>
<p>然后，<code>objc_msgSend</code>根据接收者和selector的类型决定调用哪一个方法。</p>
<ol>
<li>首先，在接收者所属类中查看方法列表，若能找到和selector名称符合的方法，跳转到对应代码；</li>
<li>否则，沿继承体系寻找父类的方法列表；</li>
<li>若最终不能找到相符的方法，执行消息转发。</li>
</ol>
<p>在搜寻方法列表时，<code>objc_msgSend</code>使用快速映射表缓存结果，以此提高性能。</p>
<h2><span id="消息转发"> 消息转发</span></h2>
<p>对象接收到无法理解的消息时，就会启动<strong>消息转发</strong>机制。消息转发分为两大阶段：</p>
<ol>
<li>
<p>动态方法解析</p>
<p>查看接收者所属类是否能够动态添加方法来处理这个未知的selector；</p>
</li>
<li>
<p>完整消息转发</p>
<p>1）让接收者查看是否存在其他的对象能够处理这条消息，有则转发消息到那个对象。例如，在一个对象内部还有其它能够处理这条消息的对象，这时，将其返回；</p>
<p>2）否则，在运行期将消息有关的细节封装在NSInvocation对象中，再一次让接收者解决当前未能处理的消息。可以通过追加参数，改换选择子等方法在触发消息前先改变消息内容。</p>
</li>
</ol>
<p>消息转发全过程可表示为下图：</p>
<p><img src="./OC-Object-and-Message/msg_forward.jpg" alt></p>
<img src="/2018/02/01/OC-Object-and-Message/msg_forward.jpg" class>
<p>步骤越往后，消息转发花费代价越大。</p>
<blockquote>
<p>参考书目: 《Effective Objective-C 2.0 编写高质量iOS与OS X代码的52个有效方法》</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Wenjie Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wenjie Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.7.1
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
